# 前端漏洞

## 1 XSS 跨站脚本攻击

**攻击类型：**

- **反射型：** 通过 url 上的参数带入
- **存储型：** 会提交到后台，比如发表评论、使用富文本

**攻击注入点：**

- **html 内容** 内容是后端提交的内容，特别是后端渲染的时候
- **html 属性** 比如 img onerror 属性，是一段代码，img 加载失败的时候就会触发
- **富文本** 富文本直接保存 html 代码

**XSS 防御：**

1. html 内容，进行转义，`<` `>`
2. html 属性，转义引号、空格
3. 富文本，白名单方式，只保留安全的标签和属性
4. innerHtml script 不会执行，但是属性会执行
5. CSP http 的一个响应头，指定哪些内容可以执行

## 2 CSRF 跨站请求伪造

**漏洞原理：**

> CSRF 有两个特点：利用 cookie 自动携带的特性以及跨站攻击

- 浏览器已打开 B 站的页面并已登录，或者浏览器登录过 B 站，登录态还保留
- 这时打开了一个攻击者页面 (诱导点击的，或者是别人发的)
- 攻击页面带有一个表单 (ajax 可能会跨域)，会自动调用 B 站的点赞接口
- 这时点赞接口会自动带上你 B 站的 cookie 进行提交
- 回到 B 站，你会看到你在不知情的情况下点了一个赞

**CSRF 蠕虫：**

- 会自动传播
- 比如你的朋友圈有一个链接
- 你点击之后，就会自动发一条朋友圈
- 你的朋友又可能会点这个链接
- 这个就是蠕虫传播

**防御：**

- **samesite：** 三个值 strict(最严格，需要域名完全一致)，Lax (稍微宽松)，none (关闭)
- **验证码和 token：** 登录时生成一个 token，将 token 设置到 cookie 中同时返回给前端。 A 网站请求接口的时候会在表单内容里面带上 token，然后后端对比表单内容的 token 和 cookie 里面的 token 是否一致，来判断请求是否有效。 这个过程用户是无感的，体验比较好
- **验证 referer：** HTTP Referer 是 header 的一部分，当浏览器向 web 服务器发送请求的时候，一般会带上 Referer

**referer 的其他用途：**

- 防盗链：只允许自己的网站访问静态资源
- 防止恶意请求

> chrome 80 后的版本 Cookie SameSite 的默认值为 Lax，也就是跨站无法带上 cookie

## 3 点击劫持

**攻击原理：**

- 用户在登陆 A 网站的系统后，被攻击者诱惑打开第三方网站
- 而第三方网站通过 iframe 引入了 A 网站的页面内容
- 用户在第三方网站中点击某个按钮（被装饰的按钮），实际上是点击了 A 网站的按钮

**防御：**

- 可以通过 `top.lcation === window.location` 来判断页面是否被嵌套，如果被嵌套，可以更改 `top.location.href` 将父级页面跳走
- `X-Frame-Options`：一个 http 头，设置当前页面是否可以被 `iframe` 嵌套

## 4 密码

常见的哈希算法，md5、sha1、sha256
