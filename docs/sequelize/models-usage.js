(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["docs/sequelize/models-usage"],{FgZ3:function(e,n){var o='<h1 id="model-usage---\u6a21\u578b\u4f7f\u7528">Model usage - \u6a21\u578b\u4f7f\u7528</h1> <h2 id="\u6570\u636e\u68c0\u7d22\u67e5\u627e\u5668">\u6570\u636e\u68c0\u7d22/\u67e5\u627e\u5668</h2> <p>Finder \u65b9\u6cd5\u65e8\u5728\u4ece\u6570\u636e\u5e93\u67e5\u8be2\u6570\u636e\u3002 \u4ed6\u4eec <strong>\u4e0d</strong> \u8fd4\u56de\u7b80\u5355\u7684\u5bf9\u8c61\uff0c\u800c\u662f\u8fd4\u56de\u6a21\u578b\u5b9e\u4f8b\u3002 \u56e0\u4e3a finder \u65b9\u6cd5\u8fd4\u56de\u6a21\u578b\u5b9e\u4f8b\uff0c\u60a8\u53ef\u4ee5\u6309\u7167 <a href="/manual/tutorial/instances.html"><em>\u5b9e\u4f8b</em></a> \u7684\u6587\u6863\u4e2d\u6240\u8ff0\uff0c\u4e3a\u7ed3\u679c\u8c03\u7528\u4efb\u4f55\u6a21\u578b\u5b9e\u4f8b\u6210\u5458\u3002</p> <p>\u5728\u672c\u6587\u4e2d\uff0c\u6211\u4eec\u5c06\u63a2\u8ba8 finder \u65b9\u6cd5\u53ef\u4ee5\u505a\u4ec0\u4e48:</p> <h3 id="find---\u641c\u7d22\u6570\u636e\u5e93\u4e2d\u7684\u4e00\u4e2a\u7279\u5b9a\u5143\u7d20"><code>find</code> - \u641c\u7d22\u6570\u636e\u5e93\u4e2d\u7684\u4e00\u4e2a\u7279\u5b9a\u5143\u7d20</h3> <pre><code class="language-js">// \u641c\u7d22\u5df2\u77e5\u7684ids\nProject.findById(123).then(project =&gt; {\n  // project \u5c06\u662f Project\u7684\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u5e76\u5177\u6709\u5728\u8868\u4e2d\u5b58\u4e3a id 123 \u6761\u76ee\u7684\u5185\u5bb9\u3002\n  // \u5982\u679c\u6ca1\u6709\u5b9a\u4e49\u8fd9\u6837\u7684\u6761\u76ee\uff0c\u4f60\u5c06\u83b7\u5f97null\n})\n\n// \u641c\u7d22\u5c5e\u6027\nProject.findOne({ where: {title: &#39;aProject&#39;} }).then(project =&gt; {\n  // project \u5c06\u662f Projects \u8868\u4e2d title \u4e3a &#39;aProject&#39;  \u7684\u7b2c\u4e00\u4e2a\u6761\u76ee || null\n})\n\n\nProject.findOne({\n  where: {title: &#39;aProject&#39;},\n  attributes: [&#39;id&#39;, [&#39;name&#39;, &#39;title&#39;]]\n}).then(project =&gt; {\n  // project \u5c06\u662f Projects \u8868\u4e2d title \u4e3a &#39;aProject&#39;  \u7684\u7b2c\u4e00\u4e2a\u6761\u76ee || null\n  // project.title \u5c06\u5305\u542b project \u7684 name\n})</code></pre> <h3 id="findorcreate---\u641c\u7d22\u7279\u5b9a\u5143\u7d20\u6216\u521b\u5efa\u5b83\uff08\u5982\u679c\u4e0d\u53ef\u7528\uff09"><code>findOrCreate</code> - \u641c\u7d22\u7279\u5b9a\u5143\u7d20\u6216\u521b\u5efa\u5b83\uff08\u5982\u679c\u4e0d\u53ef\u7528\uff09</h3> <p>\u65b9\u6cd5 <code>findOrCreate</code> \u53ef\u7528\u4e8e\u68c0\u67e5\u6570\u636e\u5e93\u4e2d\u662f\u5426\u5df2\u5b58\u5728\u67d0\u4e2a\u5143\u7d20\u3002 \u5982\u679c\u662f\u8fd9\u79cd\u60c5\u51b5\uff0c\u5219\u8be5\u65b9\u6cd5\u5c06\u751f\u6210\u76f8\u5e94\u7684\u5b9e\u4f8b\u3002 \u5982\u679c\u5143\u7d20\u4e0d\u5b58\u5728\uff0c\u5c06\u4f1a\u88ab\u521b\u5efa\u3002</p> <p>\u5982\u679c\u662f\u8fd9\u79cd\u60c5\u51b5\uff0c\u5219\u8be5\u65b9\u6cd5\u5c06\u5bfc\u81f4\u76f8\u5e94\u7684\u5b9e\u4f8b\u3002 \u5982\u679c\u5143\u7d20\u4e0d\u5b58\u5728\uff0c\u5c06\u4f1a\u88ab\u521b\u5efa\u3002</p> <p>\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u7a7a\u7684\u6570\u636e\u5e93\uff0c\u4e00\u4e2a <code>User</code> \u6a21\u578b\u6709\u4e00\u4e2a <code>username</code> \u548c <code>job</code>\u3002</p> <pre><code class="language-js">User\n  .findOrCreate({where: {username: &#39;sdepold&#39;}, defaults: {job: &#39;Technical Lead JavaScript&#39;}})\n  .spread((user, created) =&gt; {\n    console.log(user.get({\n      plain: true\n    }))\n    console.log(created)\n\n    /*\n    findOrCreate \u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u5df2\u627e\u5230\u6216\u521b\u5efa\u7684\u5bf9\u8c61\u7684\u6570\u7ec4\uff0c\u627e\u5230\u6216\u521b\u5efa\u7684\u5bf9\u8c61\u548c\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u5982\u679c\u521b\u5efa\u4e00\u4e2a\u65b0\u5bf9\u8c61\u5c06\u4e3atrue\uff0c\u5426\u5219\u4e3afalse\uff0c\u50cf\u8fd9\u6837:\n\n    [ {\n        username: &#39;sdepold&#39;,\n        job: &#39;Technical Lead JavaScript&#39;,\n        id: 1,\n        createdAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET),\n        updatedAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET)\n      },\n      true ]\n\n\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c&quot;.spread&quot; \u5c06\u6570\u7ec4\u5206\u62102\u90e8\u5206\uff0c\u5e76\u5c06\u5b83\u4eec\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9\u56de\u8c03\u51fd\u6570\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5c06\u5b83\u4eec\u89c6\u4e3a &quot;user&quot; \u548c &quot;created&quot; \u3002\uff08\u6240\u4ee5\u201cuser\u201d\u5c06\u662f\u8fd4\u56de\u6570\u7ec4\u7684\u7d22\u5f150\u7684\u5bf9\u8c61\uff0c\u5e76\u4e14 &quot;created&quot; \u5c06\u7b49\u4e8e &quot;true&quot;\u3002\uff09\n    */\n  })</code></pre> <p>\u4ee3\u7801\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684\u5b9e\u4f8b\u3002 \u6240\u4ee5\u5f53\u6211\u4eec\u5df2\u7ecf\u6709\u4e00\u4e2a\u5b9e\u4f8b\u4e86 ...</p> <pre><code class="language-js">User.create({ username: &#39;fnord&#39;, job: &#39;omnomnom&#39; })\n  .then(() =&gt; User.findOrCreate({where: {username: &#39;fnord&#39;}, defaults: {job: &#39;something else&#39;}}))\n  .spread((user, created) =&gt; {\n    console.log(user.get({\n      plain: true\n    }))\n    console.log(created)\n\n    /*\n    \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0cfindOrCreate \u8fd4\u56de\u4e00\u4e2a\u5982\u4e0b\u7684\u6570\u7ec4\uff1a\n    [ {\n        username: &#39;fnord&#39;,\n        job: &#39;omnomnom&#39;,\n        id: 2,\n        createdAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET),\n        updatedAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET)\n      },\n      false\n    ]\n    \u7531findOrCreate\u8fd4\u56de\u7684\u6570\u7ec4\u901a\u8fc7 &quot;.spread&quot; \u6269\u5c55\u4e3a\u4e24\u90e8\u5206\uff0c\u5e76\u4e14\u8fd9\u4e9b\u90e8\u5206\u5c06\u4f5c\u4e3a2\u4e2a\u53c2\u6570\u4f20\u9012\u7ed9\u56de\u8c03\u51fd\u6570\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5c06\u5176\u89c6\u4e3a &quot;user&quot; \u548c &quot;created&quot; \u3002\uff08\u6240\u4ee5\u201cuser\u201d\u5c06\u662f\u8fd4\u56de\u6570\u7ec4\u7684\u7d22\u5f150\u7684\u5bf9\u8c61\uff0c\u5e76\u4e14 &quot;created&quot; \u5c06\u7b49\u4e8e &quot;false&quot;\u3002\uff09\n    */\n  })</code></pre> <p>...\u73b0\u6709\u6761\u76ee\u5c06\u4e0d\u4f1a\u66f4\u6539\u3002 \u770b\u5230\u7b2c\u4e8c\u4e2a\u7528\u6237\u7684 &quot;job&quot;\uff0c\u5e76\u4e14\u5b9e\u9645\u4e0a\u521b\u5efa\u64cd\u4f5c\u662f\u5047\u7684\u3002</p> <h3 id="findandcountall---\u5728\u6570\u636e\u5e93\u4e2d\u641c\u7d22\u591a\u4e2a\u5143\u7d20\uff0c\u8fd4\u56de\u6570\u636e\u548c\u603b\u8ba1\u6570"><code>findAndCountAll</code> - \u5728\u6570\u636e\u5e93\u4e2d\u641c\u7d22\u591a\u4e2a\u5143\u7d20\uff0c\u8fd4\u56de\u6570\u636e\u548c\u603b\u8ba1\u6570</h3> <p>\u8fd9\u662f\u4e00\u4e2a\u65b9\u4fbf\u7684\u65b9\u6cd5\uff0c\u5b83\u7ed3\u5408\u4e86 <code>findAll</code> \u548c <code>count</code>\uff08\u89c1\u4e0b\u6587\uff09\uff0c\u5f53\u5904\u7406\u4e0e\u5206\u9875\u76f8\u5173\u7684\u67e5\u8be2\u65f6\uff0c\u8fd9\u662f\u6709\u7528\u7684\uff0c\u4f60\u60f3\u7528 <code>limit</code> \u548c <code>offset</code> \u68c0\u7d22\u6570\u636e\uff0c\u4f46\u4e5f\u9700\u8981\u77e5\u9053\u603b\u6570\u4e0e\u67e5\u8be2\u5339\u914d\u7684\u8bb0\u5f55\u6570\uff1a</p> <p>\u5904\u7406\u7a0b\u5e8f\u6210\u529f\u5c06\u59cb\u7ec8\u63a5\u6536\u5177\u6709\u4e24\u4e2a\u5c5e\u6027\u7684\u5bf9\u8c61\uff1a</p> <ul> <li><code>count</code> - \u4e00\u4e2a\u6574\u6570\uff0c\u603b\u6570\u8bb0\u5f55\u5339\u914dwhere\u8bed\u53e5\u548c\u5173\u8054\u7684\u5176\u5b83\u8fc7\u6ee4\u5668</li> <li><code>rows</code> - \u4e00\u4e2a\u6570\u7ec4\u5bf9\u8c61\uff0c\u8bb0\u5f55\u5728limit\u548coffset\u8303\u56f4\u5185\u5339\u914dwhere\u8bed\u53e5\u548c\u5173\u8054\u7684\u5176\u5b83\u8fc7\u6ee4\u5668\uff0c</li> </ul> <pre><code class="language-js">Project\n  .findAndCountAll({\n     where: {\n        title: {\n          [Op.like]: &#39;foo%&#39;\n        }\n     },\n     offset: 10,\n     limit: 2\n  })\n  .then(result =&gt; {\n    console.log(result.count);\n    console.log(result.rows);\n  });</code></pre> <p>\u5b83\u652f\u6301 include\u3002 \u53ea\u6709\u6807\u8bb0\u4e3a <code>required</code> \u7684 include \u5c06\u88ab\u6dfb\u52a0\u5230\u8ba1\u6570\u90e8\u5206\uff1a</p> <p>\u5047\u8bbe\u60a8\u60f3\u67e5\u627e\u9644\u6709\u4e2a\u4eba\u8d44\u6599\u7684\u6240\u6709\u7528\u6237\uff1a</p> <pre><code class="language-js">User.findAndCountAll({\n  include: [\n     { model: Profile, required: true}\n  ],\n  limit: 3\n});</code></pre> <p>\u56e0\u4e3a <code>Profile</code> \u7684 include \u6709 <code>required</code> \u8bbe\u7f6e\uff0c\u8fd9\u5c06\u5bfc\u81f4\u5185\u90e8\u8fde\u63a5\uff0c\u5e76\u4e14\u53ea\u6709\u5177\u6709 profile \u7684\u7528\u6237\u5c06\u88ab\u8ba1\u6570\u3002 \u5982\u679c\u6211\u4eec\u4ece include \u4e2d\u5220\u9664<code>required</code>\uff0c\u90a3\u4e48\u6709\u548c\u6ca1\u6709 profile \u7684\u7528\u6237\u90fd\u5c06\u88ab\u8ba1\u6570\u3002 \u5728include\u4e2d\u6dfb\u52a0\u4e00\u4e2a <code>where</code> \u8bed\u53e5\u4f1a\u81ea\u52a8\u4f7f\u5b83\u6210\u4e3a required\uff1a</p> <pre><code class="language-js">User.findAndCountAll({\n  include: [\n     { model: Profile, where: { active: true }}\n  ],\n  limit: 3\n});</code></pre> <p>\u4e0a\u9762\u7684\u67e5\u8be2\u53ea\u4f1a\u5bf9\u5177\u6709 active profile \u7684\u7528\u6237\u8fdb\u884c\u8ba1\u6570\uff0c\u56e0\u4e3a\u5728\u5c06 where \u8bed\u53e5\u6dfb\u52a0\u5230 include \u65f6\uff0c<code>required</code> \u88ab\u9690\u5f0f\u8bbe\u7f6e\u4e3a true\u3002</p> <p>\u4f20\u9012\u7ed9 <code>findAndCountAll</code> \u7684 options \u5bf9\u8c61\u4e0e <code>findAll</code> \u76f8\u540c\uff08\u5982\u4e0b\u6240\u8ff0\uff09\u3002</p> <h3 id="findall---\u641c\u7d22\u6570\u636e\u5e93\u4e2d\u7684\u591a\u4e2a\u5143\u7d20"><code>findAll</code> - \u641c\u7d22\u6570\u636e\u5e93\u4e2d\u7684\u591a\u4e2a\u5143\u7d20</h3> <pre><code class="language-js">// \u627e\u5230\u591a\u4e2a\u6761\u76ee\nProject.findAll().then(projects =&gt; {\n  // projects \u5c06\u662f\u6240\u6709 Project \u5b9e\u4f8b\u7684\u6570\u7ec4\n})\n\n// \u4e5f\u53ef\u4ee5\uff1a\nProject.all().then(projects =&gt; {\n  // projects \u5c06\u662f\u6240\u6709 Project \u5b9e\u4f8b\u7684\u6570\u7ec4\n})\n\n// \u641c\u7d22\u7279\u5b9a\u5c5e\u6027 - \u4f7f\u7528\u54c8\u5e0c\nProject.findAll({ where: { name: &#39;A Project&#39; } }).then(projects =&gt; {\n  // projects\u5c06\u662f\u4e00\u4e2a\u5177\u6709\u6307\u5b9a name \u7684 Project \u5b9e\u4f8b\u6570\u7ec4\n})\n\n// \u5728\u7279\u5b9a\u8303\u56f4\u5185\u8fdb\u884c\u641c\u7d22\nProject.findAll({ where: { id: [1,2,3] } }).then(projects =&gt; {\n  // projects\u5c06\u662f\u4e00\u7cfb\u5217\u5177\u6709 id 1,2 \u6216 3 \u7684\u9879\u76ee\n  // \u8fd9\u5b9e\u9645\u4e0a\u662f\u5728\u505a\u4e00\u4e2a IN \u67e5\u8be2\n})\n\nProject.findAll({\n  where: {\n    id: {\n      [Op.and]: {a: 5},           // \u4e14 (a = 5)\n      [Op.or]: [{a: 5}, {a: 6}],  // (a = 5 \u6216 a = 6)\n      [Op.gt]: 6,                // id &gt; 6\n      [Op.gte]: 6,               // id &gt;= 6\n      [Op.lt]: 10,               // id &lt; 10\n      [Op.lte]: 10,              // id &lt;= 10\n      [Op.ne]: 20,               // id != 20\n      [Op.between]: [6, 10],     // \u5728 6 \u548c 10 \u4e4b\u95f4\n      [Op.notBetween]: [11, 15], // \u4e0d\u5728 11 \u548c 15 \u4e4b\u95f4\n      [Op.in]: [1, 2],           // \u5728 [1, 2] \u4e4b\u4e2d\n      [Op.notIn]: [1, 2],        // \u4e0d\u5728 [1, 2] \u4e4b\u4e2d\n      [Op.like]: &#39;%hat&#39;,         // \u5305\u542b &#39;%hat&#39;\n      [Op.notLike]: &#39;%hat&#39;,       // \u4e0d\u5305\u542b &#39;%hat&#39;\n      [Op.iLike]: &#39;%hat&#39;,         // \u5305\u542b &#39;%hat&#39; (\u4e0d\u533a\u5206\u5927\u5c0f\u5199)  (\u4ec5\u9650 PG)\n      [Op.notILike]: &#39;%hat&#39;,      // \u4e0d\u5305\u542b &#39;%hat&#39;  (\u4ec5\u9650 PG)\n      [Op.overlap]: [1, 2],       // &amp;&amp; [1, 2] (PG\u6570\u7ec4\u91cd\u53e0\u8fd0\u7b97\u7b26)\n      [Op.contains]: [1, 2],      // @&gt; [1, 2] (PG\u6570\u7ec4\u5305\u542b\u8fd0\u7b97\u7b26)\n      [Op.contained]: [1, 2],     // &lt;@ [1, 2] (PG\u6570\u7ec4\u5305\u542b\u4e8e\u8fd0\u7b97\u7b26)\n      [Op.any]: [2,3],            // \u4efb\u4f55\u6570\u7ec4[2, 3]::INTEGER (\u4ec5\u9650 PG)\n    },\n    status: {\n      [Op.not]: false,           // status \u4e0d\u4e3a FALSE\n    }\n  }\n})</code></pre> <h3 id="\u590d\u5408\u8fc7\u6ee4--or--not-\u67e5\u8be2">\u590d\u5408\u8fc7\u6ee4 / OR / NOT \u67e5\u8be2</h3> <p>\u4f60\u53ef\u4ee5\u4f7f\u7528\u591a\u5c42\u5d4c\u5957\u7684 AND\uff0cOR \u548c NOT \u6761\u4ef6\u8fdb\u884c\u4e00\u4e2a\u590d\u5408\u7684 where \u67e5\u8be2\u3002 \u4e3a\u4e86\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>or</code> \uff0c <code>and</code> \u6216 <code>not</code> <code>\u8fd0\u7b97\u7b26</code>:</p> <pre><code class="language-js">Project.findOne({\n  where: {\n    name: &#39;a project&#39;,\n    [Op.or]: [\n      { id: [1,2,3] },\n      { id: { [Op.gt]: 10 } }\n    ]\n  }\n})\n\nProject.findOne({\n  where: {\n    name: &#39;a project&#39;,\n    id: {\n      [Op.or]: [\n        [1,2,3],\n        { [Op.gt]: 10 }\n      ]\n    }\n  }\n})</code></pre> <p>\u8fd9\u4e24\u6bb5\u4ee3\u7801\u5c06\u751f\u6210\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <pre><code class="language-sql">SELECT *\nFROM `Projects`\nWHERE (\n  `Projects`.`name` = &#39;a project&#39;\n   AND (`Projects`.`id` IN (1,2,3) OR `Projects`.`id` &gt; 10)\n)\nLIMIT 1;</code></pre> <p><code>not</code> \u793a\u4f8b:</p> <pre><code class="language-js">Project.findOne({\n  where: {\n    name: &#39;a project&#39;,\n    [Op.not]: [\n      { id: [1,2,3] },\n      { array: { [Op.contains]: [3,4,5] } }\n    ]\n  }\n});</code></pre> <p>\u5c06\u751f\u6210:</p> <pre><code class="language-sql">SELECT *\nFROM `Projects`\nWHERE (\n  `Projects`.`name` = &#39;a project&#39;\n   AND NOT (`Projects`.`id` IN (1,2,3) OR `Projects`.`array` @&gt; ARRAY[3,4,5]::INTEGER[])\n)\nLIMIT 1;</code></pre> <h3 id="\u7528\u9650\u5236\uff0c\u504f\u79fb\uff0c\u987a\u5e8f\u548c\u5206\u7ec4\u64cd\u4f5c\u6570\u636e\u96c6">\u7528\u9650\u5236\uff0c\u504f\u79fb\uff0c\u987a\u5e8f\u548c\u5206\u7ec4\u64cd\u4f5c\u6570\u636e\u96c6</h3> <p>\u8981\u83b7\u53d6\u66f4\u591a\u76f8\u5173\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528\u9650\u5236\uff0c\u504f\u79fb\uff0c\u987a\u5e8f\u548c\u5206\u7ec4\uff1a</p> <pre><code class="language-js">// \u9650\u5236\u67e5\u8be2\u7684\u7ed3\u679c\nProject.findAll({ limit: 10 })\n\n// \u8df3\u8fc7\u524d10\u4e2a\u5143\u7d20\nProject.findAll({ offset: 10 })\n\n// \u8df3\u8fc7\u524d10\u4e2a\u5143\u7d20\uff0c\u5e76\u83b7\u53d62\u4e2a\nProject.findAll({ offset: 10, limit: 2 })</code></pre> <p>\u5206\u7ec4\u548c\u6392\u5e8f\u7684\u8bed\u6cd5\u662f\u76f8\u540c\u7684\uff0c\u6240\u4ee5\u4e0b\u9762\u53ea\u7528\u4e00\u4e2a\u5355\u72ec\u7684\u4f8b\u5b50\u6765\u89e3\u91ca\u5206\u7ec4\uff0c\u800c\u5176\u4f59\u7684\u5219\u662f\u6392\u5e8f\u3002 \u60a8\u4e0b\u9762\u770b\u5230\u7684\u6240\u6709\u5185\u5bb9\u4e5f\u53ef\u4ee5\u5bf9\u5206\u7ec4\u8fdb\u884c</p> <pre><code class="language-js">Project.findAll({order: &#39;title DESC&#39;})\n// \u751f\u6210 ORDER BY title DESC\n\nProject.findAll({group: &#39;name&#39;})\n// \u751f\u6210 GROUP BY name</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u5728\u4e0a\u8ff0\u4e24\u4e2a\u793a\u4f8b\u4e2d\uff0c\u63d0\u4f9b\u7684\u5b57\u7b26\u4e32\u9010\u5b57\u63d2\u5165\u5230\u67e5\u8be2\u4e2d\uff0c\u6240\u4ee5\u4e0d\u4f1a\u8f6c\u4e49\u5217\u540d\u79f0\u3002 \u5f53\u4f60\u5411 order / group \u63d0\u4f9b\u5b57\u7b26\u4e32\u65f6\uff0c\u5c06\u59cb\u7ec8\u5982\u6b64\u3002 \u5982\u679c\u8981\u8f6c\u4e49\u5217\u540d\uff0c\u60a8\u5e94\u8be5\u63d0\u4f9b\u4e00\u4e2a\u53c2\u6570\u6570\u7ec4\uff0c\u5373\u4f7f\u60a8\u53ea\u60f3\u901a\u8fc7\u5355\u4e2a\u5217\u8fdb\u884c order / group</p> <pre><code class="language-js">something.findOne({\n  order: [\n    // \u5c06\u8fd4\u56de `name`\n    [&#39;name&#39;],\n    // \u5c06\u8fd4\u56de `username` DESC\n    [&#39;username&#39;, &#39;DESC&#39;],\n    // \u5c06\u8fd4\u56de max(`age`)\n    sequelize.fn(&#39;max&#39;, sequelize.col(&#39;age&#39;)),\n    // \u5c06\u8fd4\u56de max(`age`) DESC\n    [sequelize.fn(&#39;max&#39;, sequelize.col(&#39;age&#39;)), &#39;DESC&#39;],\n    // \u5c06\u8fd4\u56de otherfunction(`col1`, 12, &#39;lalala&#39;) DESC\n    [sequelize.fn(&#39;otherfunction&#39;, sequelize.col(&#39;col1&#39;), 12, &#39;lalala&#39;), &#39;DESC&#39;],\n    // \u5c06\u8fd4\u56de otherfunction(awesomefunction(`col`)) DESC\uff0c\u8fd9\u4e2a\u5d4c\u5957\u662f\u53ef\u4ee5\u65e0\u9650\u7684\uff01\n    [sequelize.fn(&#39;otherfunction&#39;, sequelize.fn(&#39;awesomefunction&#39;, sequelize.col(&#39;col&#39;))), &#39;DESC&#39;]\n  ]\n})</code></pre> <p>\u56de\u987e\u4e00\u4e0b\uff0corder / group\u6570\u7ec4\u7684\u5143\u7d20\u53ef\u4ee5\u662f\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <ul> <li>String - \u5c06\u88ab\u5f15\u7528</li> <li>Array - \u7b2c\u4e00\u4e2a\u5143\u7d20\u5c06\u88ab\u5f15\u7528\uff0c\u7b2c\u4e8c\u4e2a\u5c06\u88ab\u9010\u5b57\u5730\u8ffd\u52a0</li> <li>Object -<ul> <li>raw \u5c06\u88ab\u6dfb\u52a0\u9010\u5b57\u5f15\u7528</li> <li>\u5982\u679c\u672a\u8bbe\u7f6e raw\uff0c\u4e00\u5207\u90fd\u88ab\u5ffd\u7565\uff0c\u67e5\u8be2\u5c06\u5931\u8d25</li> </ul> </li> <li>Sequelize.fn \u548c Sequelize.col \u8fd4\u56de\u51fd\u6570\u548c\u5f15\u7528\u7684\u5217\u540d</li> </ul> <h3 id="\u539f\u59cb\u67e5\u8be2">\u539f\u59cb\u67e5\u8be2</h3> <p>\u6709\u65f6\u5019\uff0c\u4f60\u53ef\u80fd\u4f1a\u671f\u5f85\u4e00\u4e2a\u4f60\u60f3\u8981\u663e\u793a\u7684\u5927\u91cf\u6570\u636e\u96c6\uff0c\u800c\u65e0\u9700\u64cd\u4f5c\u3002 \u5bf9\u4e8e\u4f60\u9009\u62e9\u7684\u6bcf\u4e00\u884c\uff0cSequelize \u521b\u5efa\u4e00\u4e2a\u5177\u6709\u66f4\u65b0\uff0c\u5220\u9664\u548c\u83b7\u53d6\u5173\u8054\u7b49\u529f\u80fd\u7684\u5b9e\u4f8b\u3002\u5982\u679c\u60a8\u6709\u6570\u5343\u884c\uff0c\u5219\u53ef\u80fd\u9700\u8981\u4e00\u4e9b\u65f6\u95f4\u3002 \u5982\u679c\u60a8\u53ea\u9700\u8981\u539f\u59cb\u6570\u636e\uff0c\u5e76\u4e14\u4e0d\u60f3\u66f4\u65b0\u4efb\u4f55\u5185\u5bb9\uff0c\u60a8\u53ef\u4ee5\u8fd9\u6837\u505a\u6765\u83b7\u53d6\u539f\u59cb\u6570\u636e\u3002</p> <pre><code class="language-js">// \u4f60\u671f\u671b\u4ece\u6570\u636e\u5e93\u7684\u4e00\u4e2a\u5de8\u5927\u7684\u6570\u636e\u96c6,\n// \u5e76\u4e14\u4e0d\u60f3\u82b1\u65f6\u95f4\u4e3a\u6bcf\u4e2a\u6761\u76ee\u6784\u5efaDAO\uff1f\n// \u60a8\u53ef\u4ee5\u4f20\u9012\u4e00\u4e2a\u989d\u5916\u7684\u67e5\u8be2\u53c2\u6570\u6765\u53d6\u4ee3\u539f\u59cb\u6570\u636e\uff1a\nProject.findAll({ where: { ... }, raw: true })</code></pre> <h3 id="count---\u8ba1\u7b97\u6570\u636e\u5e93\u4e2d\u5143\u7d20\u7684\u51fa\u73b0\u6b21\u6570"><code>count</code> - \u8ba1\u7b97\u6570\u636e\u5e93\u4e2d\u5143\u7d20\u7684\u51fa\u73b0\u6b21\u6570</h3> <p>\u8fd8\u6709\u4e00\u79cd\u6570\u636e\u5e93\u5bf9\u8c61\u8ba1\u6570\u7684\u65b9\u6cd5\uff1a</p> <pre><code class="language-js">Project.count().then(c =&gt; {\n  console.log(&quot;There are &quot; + c + &quot; projects!&quot;)\n})\n\nProject.count({ where: {&#39;id&#39;: {[Op.gt]: 25}} }).then(c =&gt; {\n  console.log(&quot;There are &quot; + c + &quot; projects with an id greater than 25.&quot;)\n})</code></pre> <h3 id="max---\u83b7\u53d6\u7279\u5b9a\u8868\u4e2d\u7279\u5b9a\u5c5e\u6027\u7684\u6700\u5927\u503c"><code>max</code> - \u83b7\u53d6\u7279\u5b9a\u8868\u4e2d\u7279\u5b9a\u5c5e\u6027\u7684\u6700\u5927\u503c</h3> <p>\u8fd9\u91cc\u662f\u83b7\u53d6\u5c5e\u6027\u7684\u6700\u5927\u503c\u7684\u65b9\u6cd5\uff1a</p> <pre><code class="language-js">/*\n   \u6211\u4eec\u5047\u8bbe3\u4e2a\u5177\u6709\u5c5e\u6027\u5e74\u9f84\u7684\u5bf9\u8c61\u3002\n   \u7b2c\u4e00\u4e2a\u662f10\u5c81\uff0c\n   \u7b2c\u4e8c\u4e2a\u662f5\u5c81\uff0c\n   \u7b2c\u4e09\u4e2a\u662f40\u5c81\u3002\n*/\nProject.max(&#39;age&#39;).then(max =&gt; {\n  // \u5c06\u8fd4\u56de 40\n})\n\nProject.max(&#39;age&#39;, { where: { age: { [Op.lt]: 20 } } }).then(max =&gt; {\n  // \u5c06\u4f1a\u662f 10\n})</code></pre> <h3 id="min---\u83b7\u53d6\u7279\u5b9a\u8868\u4e2d\u7279\u5b9a\u5c5e\u6027\u7684\u6700\u5c0f\u503c"><code>min</code> - \u83b7\u53d6\u7279\u5b9a\u8868\u4e2d\u7279\u5b9a\u5c5e\u6027\u7684\u6700\u5c0f\u503c</h3> <p>\u8fd9\u91cc\u662f\u83b7\u53d6\u5c5e\u6027\u7684\u6700\u5c0f\u503c\u7684\u65b9\u6cd5\uff1a</p> <pre><code class="language-js">/*\n   \u6211\u4eec\u5047\u8bbe3\u4e2a\u5177\u6709\u5c5e\u6027\u5e74\u9f84\u7684\u5bf9\u8c61\u3002\n   \u7b2c\u4e00\u4e2a\u662f10\u5c81\uff0c\n   \u7b2c\u4e8c\u4e2a\u662f5\u5c81\uff0c\n   \u7b2c\u4e09\u4e2a\u662f40\u5c81\u3002\n*/\nProject.min(&#39;age&#39;).then(min =&gt; {\n  // \u5c06\u8fd4\u56de 5\n})\n\nProject.min(&#39;age&#39;, { where: { age: { [Op.gt]: 5 } } }).then(min =&gt; {\n  // \u5c06\u4f1a\u662f 10\n})</code></pre> <h3 id="sum---\u7279\u5b9a\u5c5e\u6027\u7684\u503c\u6c42\u548c"><code>sum</code> - \u7279\u5b9a\u5c5e\u6027\u7684\u503c\u6c42\u548c</h3> <p>\u4e3a\u4e86\u8ba1\u7b97\u8868\u7684\u7279\u5b9a\u5217\u7684\u603b\u548c\uff0c\u53ef\u4ee5\u4f7f\u7528\u201csum\u201d\u65b9\u6cd5\u3002</p> <pre><code class="language-js">/*\n   \u6211\u4eec\u5047\u8bbe3\u4e2a\u5177\u6709\u5c5e\u6027\u5e74\u9f84\u7684\u5bf9\u8c61\u3002\n   \u7b2c\u4e00\u4e2a\u662f10\u5c81\uff0c\n   \u7b2c\u4e8c\u4e2a\u662f5\u5c81\uff0c\n   \u7b2c\u4e09\u4e2a\u662f40\u5c81\u3002\n*/\nProject.sum(&#39;age&#39;).then(sum =&gt; {\n  // \u5c06\u8fd4\u56de 55\n})\n\nProject.sum(&#39;age&#39;, { where: { age: { [Op.gt]: 5 } } }).then(sum =&gt; {\n  // \u5c06\u4f1a\u662f 50\n})</code></pre> <h2 id="\u9884\u52a0\u8f7d">\u9884\u52a0\u8f7d</h2> <p>\u5f53\u4f60\u4ece\u6570\u636e\u5e93\u68c0\u7d22\u6570\u636e\u65f6\uff0c\u4e5f\u60f3\u540c\u65f6\u83b7\u5f97\u4e0e\u4e4b\u76f8\u5173\u8054\u7684\u67e5\u8be2\uff0c\u8fd9\u88ab\u79f0\u4e3a\u9884\u52a0\u8f7d\u3002\u8fd9\u4e2a\u57fa\u672c\u601d\u8def\u5c31\u662f\u5f53\u4f60\u8c03\u7528 <code>find</code> \u6216 <code>findAll</code> \u65f6\u4f7f\u7528 <code>include</code> \u5c5e\u6027\u3002\u8ba9\u6211\u4eec\u5047\u8bbe\u4ee5\u4e0b\u8bbe\u7f6e\uff1a</p> <pre><code class="language-js">const User = sequelize.define(&#39;user&#39;, { name: Sequelize.STRING })\nconst Task = sequelize.define(&#39;task&#39;, { name: Sequelize.STRING })\nconst Tool = sequelize.define(&#39;tool&#39;, { name: Sequelize.STRING })\n\nTask.belongsTo(User)\nUser.hasMany(Task)\nUser.hasMany(Tool, { as: &#39;Instruments&#39; })\n\nsequelize.sync().then(() =&gt; {\n  // \u8fd9\u662f\u6211\u4eec\u7ee7\u7eed\u7684\u5730\u65b9 ...\n})</code></pre> <p>\u9996\u5148\uff0c\u8ba9\u6211\u4eec\u7528\u5b83\u4eec\u7684\u5173\u8054 user \u52a0\u8f7d\u6240\u6709\u7684 task\u3002</p> <pre><code class="language-js">Task.findAll({ include: [ User ] }).then(tasks =&gt; {\n  console.log(JSON.stringify(tasks))\n\n  /*\n    [{\n      &quot;name&quot;: &quot;A Task&quot;,\n      &quot;id&quot;: 1,\n      &quot;createdAt&quot;: &quot;2013-03-20T20:31:40.000Z&quot;,\n      &quot;updatedAt&quot;: &quot;2013-03-20T20:31:40.000Z&quot;,\n      &quot;userId&quot;: 1,\n      &quot;user&quot;: {\n        &quot;name&quot;: &quot;John Doe&quot;,\n        &quot;id&quot;: 1,\n        &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n        &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;\n      }\n    }]\n  */\n})</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u8bbf\u95ee\u8005\uff08\u7ed3\u679c\u5b9e\u4f8b\u4e2d\u7684 <code>User</code> \u5c5e\u6027\uff09\u662f\u5355\u6570\u5f62\u5f0f\uff0c\u56e0\u4e3a\u5173\u8054\u662f\u4e00\u5bf9\u4e00\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\u7684\u4e8b\u60c5\uff1a\u7528\u591a\u5bf9\u4e00\u7684\u5173\u8054\u52a0\u8f7d\u6570\u636e\uff01</p> <pre><code class="language-js">User.findAll({ include: [ Task ] }).then(users =&gt; {\n  console.log(JSON.stringify(users))\n\n  /*\n    [{\n      &quot;name&quot;: &quot;John Doe&quot;,\n      &quot;id&quot;: 1,\n      &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n      &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n      &quot;tasks&quot;: [{\n        &quot;name&quot;: &quot;A Task&quot;,\n        &quot;id&quot;: 1,\n        &quot;createdAt&quot;: &quot;2013-03-20T20:31:40.000Z&quot;,\n        &quot;updatedAt&quot;: &quot;2013-03-20T20:31:40.000Z&quot;,\n        &quot;userId&quot;: 1\n      }]\n    }]\n  */\n})</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u8bbf\u95ee\u8005\uff08\u7ed3\u679c\u5b9e\u4f8b\u4e2d\u7684 <code>Tasks</code> \u5c5e\u6027\uff09\u662f\u590d\u6570\u5f62\u5f0f\uff0c\u56e0\u4e3a\u5173\u8054\u662f\u591a\u5bf9\u4e00\u7684\u3002</p> <p>\u5982\u679c\u5173\u8054\u662f\u522b\u540d\u7684\uff08\u4f7f\u7528 <code>as</code> \u53c2\u6570\uff09\uff0c\u5219\u5728\u5305\u542b\u6a21\u578b\u65f6\u5fc5\u987b\u6307\u5b9a\u6b64\u522b\u540d\u3002 \u6ce8\u610f\u7528\u6237\u7684 <code>Tool</code> \u5982\u4f55\u88ab\u522b\u540d\u4e3a <code>Instruments</code>\u3002 \u4e3a\u4e86\u83b7\u5f97\u6b63\u786e\u7684\u6743\u9650\uff0c\u60a8\u5fc5\u987b\u6307\u5b9a\u8981\u52a0\u8f7d\u7684\u6a21\u578b\u4ee5\u53ca\u522b\u540d\uff1a</p> <pre><code class="language-js">User.findAll({ include: [{ model: Tool, as: &#39;Instruments&#39; }] }).then(users =&gt; {\n  console.log(JSON.stringify(users))\n\n  /*\n    [{\n      &quot;name&quot;: &quot;John Doe&quot;,\n      &quot;id&quot;: 1,\n      &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n      &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n      &quot;Instruments&quot;: [{\n        &quot;name&quot;: &quot;Toothpick&quot;,\n        &quot;id&quot;: 1,\n        &quot;createdAt&quot;: null,\n        &quot;updatedAt&quot;: null,\n        &quot;userId&quot;: 1\n      }]\n    }]\n  */\n})</code></pre> <p>\u60a8\u8fd8\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a\u4e0e\u5173\u8054\u522b\u540d\u5339\u914d\u7684\u5b57\u7b26\u4e32\u6765\u5305\u542b\u522b\u540d\uff1a</p> <pre><code class="language-js">User.findAll({ include: [&#39;Instruments&#39;] }).then(users =&gt; {\n  console.log(JSON.stringify(users))\n\n  /*\n    [{\n      &quot;name&quot;: &quot;John Doe&quot;,\n      &quot;id&quot;: 1,\n      &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n      &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n      &quot;Instruments&quot;: [{\n        &quot;name&quot;: &quot;Toothpick&quot;,\n        &quot;id&quot;: 1,\n        &quot;createdAt&quot;: null,\n        &quot;updatedAt&quot;: null,\n        &quot;userId&quot;: 1\n      }]\n    }]\n  */\n})\n\nUser.findAll({ include: [{ association: &#39;Instruments&#39; }] }).then(users =&gt; {\n  console.log(JSON.stringify(users))\n\n  /*\n    [{\n      &quot;name&quot;: &quot;John Doe&quot;,\n      &quot;id&quot;: 1,\n      &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n      &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n      &quot;Instruments&quot;: [{\n        &quot;name&quot;: &quot;Toothpick&quot;,\n        &quot;id&quot;: 1,\n        &quot;createdAt&quot;: null,\n        &quot;updatedAt&quot;: null,\n        &quot;userId&quot;: 1\n      }]\n    }]\n  */\n})</code></pre> <p>\u5f53\u9884\u52a0\u8f7d\u65f6\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>where</code> \u8fc7\u6ee4\u5173\u8054\u7684\u6a21\u578b\u3002 \u8fd9\u5c06\u8fd4\u56de <code>Tool</code> \u6a21\u578b\u4e2d\u6240\u6709\u4e0e <code>where</code> \u8bed\u53e5\u5339\u914d\u7684\u884c\u7684<code>User</code>\u3002</p> <pre><code class="language-js">User.findAll({\n    include: [{\n        model: Tool,\n        as: &#39;Instruments&#39;,\n        where: { name: { [Op.like]: &#39;%ooth%&#39; } }\n    }]\n}).then(users =&gt; {\n    console.log(JSON.stringify(users))\n\n    /*\n      [{\n        &quot;name&quot;: &quot;John Doe&quot;,\n        &quot;id&quot;: 1,\n        &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n        &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n        &quot;Instruments&quot;: [{\n          &quot;name&quot;: &quot;Toothpick&quot;,\n          &quot;id&quot;: 1,\n          &quot;createdAt&quot;: null,\n          &quot;updatedAt&quot;: null,\n          &quot;userId&quot;: 1\n        }]\n      }],\n\n      [{\n        &quot;name&quot;: &quot;John Smith&quot;,\n        &quot;id&quot;: 2,\n        &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n        &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n        &quot;Instruments&quot;: [{\n          &quot;name&quot;: &quot;Toothpick&quot;,\n          &quot;id&quot;: 1,\n          &quot;createdAt&quot;: null,\n          &quot;updatedAt&quot;: null,\n          &quot;userId&quot;: 1\n        }]\n      }],\n    */\n  })</code></pre> <p>\u5f53\u4f7f\u7528 <code>include.where</code> \u8fc7\u6ee4\u4e00\u4e2a\u9884\u52a0\u8f7d\u7684\u6a21\u578b\u65f6\uff0c<code>include.required</code> \u88ab\u9690\u5f0f\u8bbe\u7f6e\u4e3a <code>true</code>\u3002 \u8fd9\u610f\u5473\u7740\u5185\u90e8\u8054\u63a5\u5b8c\u6210\u8fd4\u56de\u5177\u6709\u4efb\u4f55\u5339\u914d\u5b50\u9879\u7684\u7236\u6a21\u578b\u3002</p> <h3 id="\u4f7f\u7528\u9884\u52a0\u8f7d\u6a21\u578b\u7684\u9876\u5c42-where">\u4f7f\u7528\u9884\u52a0\u8f7d\u6a21\u578b\u7684\u9876\u5c42 WHERE</h3> <p>\u5c06\u6a21\u578b\u7684 <code>WHERE</code> \u6761\u4ef6\u4ece <code>ON</code> \u6761\u4ef6\u7684 include \u6a21\u5f0f\u79fb\u52a8\u5230\u9876\u5c42\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>&#39;$nested.column$&#39;</code> \u8bed\u6cd5\uff1a</p> <pre><code class="language-js">User.findAll({\n    where: {\n        &#39;$Instruments.name$&#39;: { [Op.iLike]: &#39;%ooth%&#39; }\n    },\n    include: [{\n        model: Tool,\n        as: &#39;Instruments&#39;\n    }]\n}).then(users =&gt; {\n    console.log(JSON.stringify(users));\n\n    /*\n      [{\n        &quot;name&quot;: &quot;John Doe&quot;,\n        &quot;id&quot;: 1,\n        &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n        &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n        &quot;Instruments&quot;: [{\n          &quot;name&quot;: &quot;Toothpick&quot;,\n          &quot;id&quot;: 1,\n          &quot;createdAt&quot;: null,\n          &quot;updatedAt&quot;: null,\n          &quot;userId&quot;: 1\n        }]\n      }],\n\n      [{\n        &quot;name&quot;: &quot;John Smith&quot;,\n        &quot;id&quot;: 2,\n        &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n        &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n        &quot;Instruments&quot;: [{\n          &quot;name&quot;: &quot;Toothpick&quot;,\n          &quot;id&quot;: 1,\n          &quot;createdAt&quot;: null,\n          &quot;updatedAt&quot;: null,\n          &quot;userId&quot;: 1\n        }]\n      }],\n    */</code></pre> <h3 id="\u5305\u62ec\u6240\u6709">\u5305\u62ec\u6240\u6709</h3> <p>\u8981\u5305\u542b\u6240\u6709\u5c5e\u6027\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 <code>all\uff1atrue</code> \u4f20\u9012\u5355\u4e2a\u5bf9\u8c61\uff1a</p> <pre><code class="language-js">User.findAll({ include: [{ all: true }]});</code></pre> <h3 id="\u5305\u62ec\u8f6f\u5220\u9664\u7684\u8bb0\u5f55">\u5305\u62ec\u8f6f\u5220\u9664\u7684\u8bb0\u5f55</h3> <p>\u5982\u679c\u60f3\u8981\u52a0\u8f7d\u8f6f\u5220\u9664\u7684\u8bb0\u5f55\uff0c\u53ef\u4ee5\u901a\u8fc7\u5c06 <code>include.paranoid</code> \u8bbe\u7f6e\u4e3a <code>false</code> \u6765\u5b9e\u73b0</p> <pre><code class="language-js">User.findAll({\n    include: [{\n        model: Tool,\n        where: { name: { [Op.like]: &#39;%ooth%&#39; } },\n        paranoid: false // query and loads the soft deleted records\n    }]\n});</code></pre> <h3 id="\u6392\u5e8f\u9884\u52a0\u8f7d\u5173\u8054">\u6392\u5e8f\u9884\u52a0\u8f7d\u5173\u8054</h3> <p>\u5728\u4e00\u5bf9\u591a\u5173\u7cfb\u7684\u60c5\u51b5\u4e0b\u3002</p> <pre><code class="language-js">Company.findAll({ include: [ Division ], order: [ [ Division, &#39;name&#39; ] ] });\nCompany.findAll({ include: [ Division ], order: [ [ Division, &#39;name&#39;, &#39;DESC&#39; ] ] });\nCompany.findAll({\n  include: [ { model: Division, as: &#39;Div&#39; } ],\n  order: [ [ { model: Division, as: &#39;Div&#39; }, &#39;name&#39; ] ]\n});\nCompany.findAll({\n  include: [ { model: Division, as: &#39;Div&#39; } ],\n  order: [ [ { model: Division, as: &#39;Div&#39; }, &#39;name&#39;, &#39;DESC&#39; ] ]\n});\nCompany.findAll({\n  include: [ { model: Division, include: [ Department ] } ],\n  order: [ [ Division, Department, &#39;name&#39; ] ]\n});</code></pre> <p>\u5728\u591a\u5bf9\u591a\u5173\u7cfb\u7684\u60c5\u51b5\u4e0b\uff0c\u60a8\u8fd8\u53ef\u4ee5\u901a\u8fc7\u8868\u4e2d\u7684\u5c5e\u6027\u8fdb\u884c\u6392\u5e8f\u3002</p> <pre><code class="language-js">Company.findAll({\n  include: [ { model: Division, include: [ Department ] } ],\n  order: [ [ Division, DepartmentDivision, &#39;name&#39; ] ]\n});</code></pre> <h3 id="\u5d4c\u5957\u9884\u52a0\u8f7d">\u5d4c\u5957\u9884\u52a0\u8f7d</h3> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528\u5d4c\u5957\u7684\u9884\u52a0\u8f7d\u6765\u52a0\u8f7d\u76f8\u5173\u6a21\u578b\u7684\u6240\u6709\u76f8\u5173\u6a21\u578b\uff1a</p> <pre><code class="language-js">User.findAll({\n  include: [\n    {model: Tool, as: &#39;Instruments&#39;, include: [\n      {model: Teacher, include: [ /* etc */]}\n    ]}\n  ]\n}).then(users =&gt; {\n  console.log(JSON.stringify(users))\n\n  /*\n    [{\n      &quot;name&quot;: &quot;John Doe&quot;,\n      &quot;id&quot;: 1,\n      &quot;createdAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n      &quot;updatedAt&quot;: &quot;2013-03-20T20:31:45.000Z&quot;,\n      &quot;Instruments&quot;: [{ // 1:M and N:M association\n        &quot;name&quot;: &quot;Toothpick&quot;,\n        &quot;id&quot;: 1,\n        &quot;createdAt&quot;: null,\n        &quot;updatedAt&quot;: null,\n        &quot;userId&quot;: 1,\n        &quot;Teacher&quot;: { // 1:1 association\n          &quot;name&quot;: &quot;Jimi Hendrix&quot;\n        }\n      }]\n    }]\n  */\n})</code></pre> <p>\u8fd9\u5c06\u4ea7\u751f\u4e00\u4e2a\u5916\u8fde\u63a5\u3002 \u4f46\u662f\uff0c\u76f8\u5173\u6a21\u578b\u4e0a\u7684 <code>where</code> \u8bed\u53e5\u5c06\u521b\u5efa\u4e00\u4e2a\u5185\u90e8\u8fde\u63a5\uff0c\u5e76\u4ec5\u8fd4\u56de\u5177\u6709\u5339\u914d\u5b50\u6a21\u578b\u7684\u5b9e\u4f8b\u3002 \u8981\u8fd4\u56de\u6240\u6709\u7236\u5b9e\u4f8b\uff0c\u60a8\u5e94\u8be5\u6dfb\u52a0 <code>required: false</code>\u3002</p> <pre><code class="language-js">User.findAll({\n  include: [{\n    model: Tool,\n    as: &#39;Instruments&#39;,\n    include: [{\n      model: Teacher,\n      where: {\n        school: &quot;Woodstock Music School&quot;\n      },\n      required: false\n    }]\n  }]\n}).then(users =&gt; {\n  /* ... */\n})</code></pre> <p>\u4ee5\u4e0a\u67e5\u8be2\u5c06\u8fd4\u56de\u6240\u6709\u7528\u6237\u53ca\u5176\u6240\u6709\u4e50\u5668\uff0c\u4f46\u53ea\u4f1a\u8fd4\u56de\u4e0e <code>Woodstock Music School</code> \u76f8\u5173\u7684\u8001\u5e08\u3002</p> <p>\u5305\u62ec\u6240\u6709\u4e5f\u652f\u6301\u5d4c\u5957\u52a0\u8f7d\uff1a</p> <pre><code class="language-js">User.findAll({ include: [{ all: true, nested: true }]});</code></pre> ';e.exports=o}}]);