(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["docs/es6/proxy"],{XD5A:function(e,o){var r='<h1 id="proxy">Proxy</h1> <h2 id="\u6982\u8ff0">\u6982\u8ff0</h2> <p>Proxy \u7528\u4e8e\u4fee\u6539\u67d0\u4e9b\u64cd\u4f5c\u7684\u9ed8\u8ba4\u884c\u4e3a\uff0c\u7b49\u540c\u4e8e\u5728\u8bed\u8a00\u5c42\u9762\u505a\u51fa\u4fee\u6539\uff0c\u6240\u4ee5\u5c5e\u4e8e\u4e00\u79cd\u201c\u5143\u7f16\u7a0b\u201d\uff08meta programming\uff09\uff0c\u5373\u5bf9\u7f16\u7a0b\u8bed\u8a00\u8fdb\u884c\u7f16\u7a0b\u3002</p> <p>Proxy \u53ef\u4ee5\u7406\u89e3\u6210\uff0c\u5728\u76ee\u6807\u5bf9\u8c61\u4e4b\u524d\u67b6\u8bbe\u4e00\u5c42\u201c\u62e6\u622a\u201d\uff0c\u5916\u754c\u5bf9\u8be5\u5bf9\u8c61\u7684\u8bbf\u95ee\uff0c\u90fd\u5fc5\u987b\u5148\u901a\u8fc7\u8fd9\u5c42\u62e6\u622a\uff0c\u56e0\u6b64\u63d0\u4f9b\u4e86\u4e00\u79cd\u673a\u5236\uff0c\u53ef\u4ee5\u5bf9\u5916\u754c\u7684\u8bbf\u95ee\u8fdb\u884c\u8fc7\u6ee4\u548c\u6539\u5199\u3002Proxy \u8fd9\u4e2a\u8bcd\u7684\u539f\u610f\u662f\u4ee3\u7406\uff0c\u7528\u5728\u8fd9\u91cc\u8868\u793a\u7531\u5b83\u6765\u201c\u4ee3\u7406\u201d\u67d0\u4e9b\u64cd\u4f5c\uff0c\u53ef\u4ee5\u8bd1\u4e3a\u201c\u4ee3\u7406\u5668\u201d\u3002</p> <pre><code class="language-javascript">var obj = new Proxy({}, {\n  get: function (target, key, receiver) {\n    console.log(`getting ${key}!`);\n    return Reflect.get(target, key, receiver);\n  },\n  set: function (target, key, value, receiver) {\n    console.log(`setting ${key}!`);\n    return Reflect.set(target, key, value, receiver);\n  }\n});</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u5bf9\u4e00\u4e2a\u7a7a\u5bf9\u8c61\u67b6\u8bbe\u4e86\u4e00\u5c42\u62e6\u622a\uff0c\u91cd\u5b9a\u4e49\u4e86\u5c5e\u6027\u7684\u8bfb\u53d6\uff08<code>get</code>\uff09\u548c\u8bbe\u7f6e\uff08<code>set</code>\uff09\u884c\u4e3a\u3002\u8fd9\u91cc\u6682\u65f6\u5148\u4e0d\u89e3\u91ca\u5177\u4f53\u7684\u8bed\u6cd5\uff0c\u53ea\u770b\u8fd0\u884c\u7ed3\u679c\u3002\u5bf9\u8bbe\u7f6e\u4e86\u62e6\u622a\u884c\u4e3a\u7684\u5bf9\u8c61<code>obj</code>\uff0c\u53bb\u8bfb\u5199\u5b83\u7684\u5c5e\u6027\uff0c\u5c31\u4f1a\u5f97\u5230\u4e0b\u9762\u7684\u7ed3\u679c\u3002</p> <pre><code class="language-javascript">obj.count = 1\n//  setting count!\n++obj.count\n//  getting count!\n//  setting count!\n//  2</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u8bf4\u660e\uff0cProxy \u5b9e\u9645\u4e0a\u91cd\u8f7d\uff08overload\uff09\u4e86\u70b9\u8fd0\u7b97\u7b26\uff0c\u5373\u7528\u81ea\u5df1\u7684\u5b9a\u4e49\u8986\u76d6\u4e86\u8bed\u8a00\u7684\u539f\u59cb\u5b9a\u4e49\u3002</p> <p>ES6 \u539f\u751f\u63d0\u4f9b Proxy \u6784\u9020\u51fd\u6570\uff0c\u7528\u6765\u751f\u6210 Proxy \u5b9e\u4f8b\u3002</p> <pre><code class="language-javascript">var proxy = new Proxy(target, handler);</code></pre> <p>Proxy \u5bf9\u8c61\u7684\u6240\u6709\u7528\u6cd5\uff0c\u90fd\u662f\u4e0a\u9762\u8fd9\u79cd\u5f62\u5f0f\uff0c\u4e0d\u540c\u7684\u53ea\u662f<code>handler</code>\u53c2\u6570\u7684\u5199\u6cd5\u3002\u5176\u4e2d\uff0c<code>new Proxy()</code>\u8868\u793a\u751f\u6210\u4e00\u4e2a<code>Proxy</code>\u5b9e\u4f8b\uff0c<code>target</code>\u53c2\u6570\u8868\u793a\u6240\u8981\u62e6\u622a\u7684\u76ee\u6807\u5bf9\u8c61\uff0c<code>handler</code>\u53c2\u6570\u4e5f\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u7528\u6765\u5b9a\u5236\u62e6\u622a\u884c\u4e3a\u3002</p> <p>\u4e0b\u9762\u662f\u53e6\u4e00\u4e2a\u62e6\u622a\u8bfb\u53d6\u5c5e\u6027\u884c\u4e3a\u7684\u4f8b\u5b50\u3002</p> <pre><code class="language-javascript">var proxy = new Proxy({}, {\n  get: function(target, property) {\n    return 35;\n  }\n});\n\nproxy.time // 35\nproxy.name // 35\nproxy.title // 35</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c\u4f5c\u4e3a\u6784\u9020\u51fd\u6570\uff0c<code>Proxy</code>\u63a5\u53d7\u4e24\u4e2a\u53c2\u6570\u3002\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u6240\u8981\u4ee3\u7406\u7684\u76ee\u6807\u5bf9\u8c61\uff08\u4e0a\u4f8b\u662f\u4e00\u4e2a\u7a7a\u5bf9\u8c61\uff09\uff0c\u5373\u5982\u679c\u6ca1\u6709<code>Proxy</code>\u7684\u4ecb\u5165\uff0c\u64cd\u4f5c\u539f\u6765\u8981\u8bbf\u95ee\u7684\u5c31\u662f\u8fd9\u4e2a\u5bf9\u8c61\uff1b\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a\u914d\u7f6e\u5bf9\u8c61\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u88ab\u4ee3\u7406\u7684\u64cd\u4f5c\uff0c\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u5bf9\u5e94\u7684\u5904\u7406\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u5c06\u62e6\u622a\u5bf9\u5e94\u7684\u64cd\u4f5c\u3002\u6bd4\u5982\uff0c\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c\u914d\u7f6e\u5bf9\u8c61\u6709\u4e00\u4e2a<code>get</code>\u65b9\u6cd5\uff0c\u7528\u6765\u62e6\u622a\u5bf9\u76ee\u6807\u5bf9\u8c61\u5c5e\u6027\u7684\u8bbf\u95ee\u8bf7\u6c42\u3002<code>get</code>\u65b9\u6cd5\u7684\u4e24\u4e2a\u53c2\u6570\u5206\u522b\u662f\u76ee\u6807\u5bf9\u8c61\u548c\u6240\u8981\u8bbf\u95ee\u7684\u5c5e\u6027\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u7531\u4e8e\u62e6\u622a\u51fd\u6570\u603b\u662f\u8fd4\u56de<code>35</code>\uff0c\u6240\u4ee5\u8bbf\u95ee\u4efb\u4f55\u5c5e\u6027\u90fd\u5f97\u5230<code>35</code>\u3002</p> <p>\u6ce8\u610f\uff0c\u8981\u4f7f\u5f97<code>Proxy</code>\u8d77\u4f5c\u7528\uff0c\u5fc5\u987b\u9488\u5bf9<code>Proxy</code>\u5b9e\u4f8b\uff08\u4e0a\u4f8b\u662f<code>proxy</code>\u5bf9\u8c61\uff09\u8fdb\u884c\u64cd\u4f5c\uff0c\u800c\u4e0d\u662f\u9488\u5bf9\u76ee\u6807\u5bf9\u8c61\uff08\u4e0a\u4f8b\u662f\u7a7a\u5bf9\u8c61\uff09\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p>\u5982\u679c<code>handler</code>\u6ca1\u6709\u8bbe\u7f6e\u4efb\u4f55\u62e6\u622a\uff0c\u90a3\u5c31\u7b49\u540c\u4e8e\u76f4\u63a5\u901a\u5411\u539f\u5bf9\u8c61\u3002</p> <pre><code class="language-javascript">var target = {};\nvar handler = {};\nvar proxy = new Proxy(target, handler);\nproxy.a = &#39;b&#39;;\ntarget.a // &quot;b&quot;</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c<code>handler</code>\u662f\u4e00\u4e2a\u7a7a\u5bf9\u8c61\uff0c\u6ca1\u6709\u4efb\u4f55\u62e6\u622a\u6548\u679c\uff0c\u8bbf\u95ee<code>proxy</code>\u5c31\u7b49\u540c\u4e8e\u8bbf\u95ee<code>target</code>\u3002</p> <p>\u4e00\u4e2a\u6280\u5de7\u662f\u5c06 Proxy \u5bf9\u8c61\uff0c\u8bbe\u7f6e\u5230<code>object.proxy</code>\u5c5e\u6027\uff0c\u4ece\u800c\u53ef\u4ee5\u5728<code>object</code>\u5bf9\u8c61\u4e0a\u8c03\u7528\u3002</p> <pre><code class="language-javascript">var object = { proxy: new Proxy(target, handler) };</code></pre> <p>Proxy \u5b9e\u4f8b\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u5176\u4ed6\u5bf9\u8c61\u7684\u539f\u578b\u5bf9\u8c61\u3002</p> <pre><code class="language-javascript">var proxy = new Proxy({}, {\n  get: function(target, property) {\n    return 35;\n  }\n});\n\nlet obj = Object.create(proxy);\nobj.time // 35</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c<code>proxy</code>\u5bf9\u8c61\u662f<code>obj</code>\u5bf9\u8c61\u7684\u539f\u578b\uff0c<code>obj</code>\u5bf9\u8c61\u672c\u8eab\u5e76\u6ca1\u6709<code>time</code>\u5c5e\u6027\uff0c\u6240\u4ee5\u6839\u636e\u539f\u578b\u94fe\uff0c\u4f1a\u5728<code>proxy</code>\u5bf9\u8c61\u4e0a\u8bfb\u53d6\u8be5\u5c5e\u6027\uff0c\u5bfc\u81f4\u88ab\u62e6\u622a\u3002</p> <p>\u540c\u4e00\u4e2a\u62e6\u622a\u5668\u51fd\u6570\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u62e6\u622a\u591a\u4e2a\u64cd\u4f5c\u3002</p> <pre><code class="language-javascript">var handler = {\n  get: function(target, name) {\n    if (name === &#39;prototype&#39;) {\n      return Object.prototype;\n    }\n    return &#39;Hello, &#39; + name;\n  },\n\n  apply: function(target, thisBinding, args) {\n    return args[0];\n  },\n\n  construct: function(target, args) {\n    return {value: args[1]};\n  }\n};\n\nvar fproxy = new Proxy(function(x, y) {\n  return x + y;\n}, handler);\n\nfproxy(1, 2) // 1\nnew fproxy(1, 2) // {value: 2}\nfproxy.prototype === Object.prototype // true\nfproxy.foo === &quot;Hello, foo&quot; // true</code></pre> <p>\u5bf9\u4e8e\u53ef\u4ee5\u8bbe\u7f6e\u3001\u4f46\u6ca1\u6709\u8bbe\u7f6e\u62e6\u622a\u7684\u64cd\u4f5c\uff0c\u5219\u76f4\u63a5\u843d\u5728\u76ee\u6807\u5bf9\u8c61\u4e0a\uff0c\u6309\u7167\u539f\u5148\u7684\u65b9\u5f0f\u4ea7\u751f\u7ed3\u679c\u3002</p> <p>\u4e0b\u9762\u662f Proxy \u652f\u6301\u7684\u62e6\u622a\u64cd\u4f5c\u4e00\u89c8\uff0c\u4e00\u5171 13 \u79cd\u3002</p> <ul> <li><strong>get(target, propKey, receiver)</strong>\uff1a\u62e6\u622a\u5bf9\u8c61\u5c5e\u6027\u7684\u8bfb\u53d6\uff0c\u6bd4\u5982<code>proxy.foo</code>\u548c<code>proxy[&#39;foo&#39;]</code>\u3002</li> <li><strong>set(target, propKey, value, receiver)</strong>\uff1a\u62e6\u622a\u5bf9\u8c61\u5c5e\u6027\u7684\u8bbe\u7f6e\uff0c\u6bd4\u5982<code>proxy.foo = v</code>\u6216<code>proxy[&#39;foo&#39;] = v</code>\uff0c\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\u3002</li> <li><strong>has(target, propKey)</strong>\uff1a\u62e6\u622a<code>propKey in proxy</code>\u7684\u64cd\u4f5c\uff0c\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\u3002</li> <li><strong>deleteProperty(target, propKey)</strong>\uff1a\u62e6\u622a<code>delete proxy[propKey]</code>\u7684\u64cd\u4f5c\uff0c\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\u3002</li> <li><strong>ownKeys(target)</strong>\uff1a\u62e6\u622a<code>Object.getOwnPropertyNames(proxy)</code>\u3001<code>Object.getOwnPropertySymbols(proxy)</code>\u3001<code>Object.keys(proxy)</code>\uff0c\u8fd4\u56de\u4e00\u4e2a\u6570\u7ec4\u3002\u8be5\u65b9\u6cd5\u8fd4\u56de\u76ee\u6807\u5bf9\u8c61\u6240\u6709\u81ea\u8eab\u7684\u5c5e\u6027\u7684\u5c5e\u6027\u540d\uff0c\u800c<code>Object.keys()</code>\u7684\u8fd4\u56de\u7ed3\u679c\u4ec5\u5305\u62ec\u76ee\u6807\u5bf9\u8c61\u81ea\u8eab\u7684\u53ef\u904d\u5386\u5c5e\u6027\u3002</li> <li><strong>getOwnPropertyDescriptor(target, propKey)</strong>\uff1a\u62e6\u622a<code>Object.getOwnPropertyDescriptor(proxy, propKey)</code>\uff0c\u8fd4\u56de\u5c5e\u6027\u7684\u63cf\u8ff0\u5bf9\u8c61\u3002</li> <li><strong>defineProperty(target, propKey, propDesc)</strong>\uff1a\u62e6\u622a<code>Object.defineProperty(proxy, propKey, propDesc\uff09</code>\u3001<code>Object.defineProperties(proxy, propDescs)</code>\uff0c\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\u3002</li> <li><strong>preventExtensions(target)</strong>\uff1a\u62e6\u622a<code>Object.preventExtensions(proxy)</code>\uff0c\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\u3002</li> <li><strong>getPrototypeOf(target)</strong>\uff1a\u62e6\u622a<code>Object.getPrototypeOf(proxy)</code>\uff0c\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61\u3002</li> <li><strong>isExtensible(target)</strong>\uff1a\u62e6\u622a<code>Object.isExtensible(proxy)</code>\uff0c\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\u3002</li> <li><strong>setPrototypeOf(target, proto)</strong>\uff1a\u62e6\u622a<code>Object.setPrototypeOf(proxy, proto)</code>\uff0c\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\u3002\u5982\u679c\u76ee\u6807\u5bf9\u8c61\u662f\u51fd\u6570\uff0c\u90a3\u4e48\u8fd8\u6709\u4e24\u79cd\u989d\u5916\u64cd\u4f5c\u53ef\u4ee5\u62e6\u622a\u3002</li> <li><strong>apply(target, object, args)</strong>\uff1a\u62e6\u622a Proxy \u5b9e\u4f8b\u4f5c\u4e3a\u51fd\u6570\u8c03\u7528\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982<code>proxy(...args)</code>\u3001<code>proxy.call(object, ...args)</code>\u3001<code>proxy.apply(...)</code>\u3002</li> <li><strong>construct(target, args)</strong>\uff1a\u62e6\u622a Proxy \u5b9e\u4f8b\u4f5c\u4e3a\u6784\u9020\u51fd\u6570\u8c03\u7528\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982<code>new proxy(...args)</code>\u3002</li> </ul> <h2 id="proxy-\u5b9e\u4f8b\u7684\u65b9\u6cd5">Proxy \u5b9e\u4f8b\u7684\u65b9\u6cd5</h2> <p>\u4e0b\u9762\u662f\u4e0a\u9762\u8fd9\u4e9b\u62e6\u622a\u65b9\u6cd5\u7684\u8be6\u7ec6\u4ecb\u7ecd\u3002</p> <h3 id="get">get()</h3> <p><code>get</code>\u65b9\u6cd5\u7528\u4e8e\u62e6\u622a\u67d0\u4e2a\u5c5e\u6027\u7684\u8bfb\u53d6\u64cd\u4f5c\uff0c\u53ef\u4ee5\u63a5\u53d7\u4e09\u4e2a\u53c2\u6570\uff0c\u4f9d\u6b21\u4e3a\u76ee\u6807\u5bf9\u8c61\u3001\u5c5e\u6027\u540d\u548c proxy \u5b9e\u4f8b\u672c\u8eab\uff08\u5373<code>this</code>\u5173\u952e\u5b57\u6307\u5411\u7684\u90a3\u4e2a\u5bf9\u8c61\uff09\uff0c\u5176\u4e2d\u6700\u540e\u4e00\u4e2a\u53c2\u6570\u53ef\u9009\u3002</p> <p><code>get</code>\u65b9\u6cd5\u7684\u7528\u6cd5\uff0c\u4e0a\u6587\u5df2\u7ecf\u6709\u4e00\u4e2a\u4f8b\u5b50\uff0c\u4e0b\u9762\u662f\u53e6\u4e00\u4e2a\u62e6\u622a\u8bfb\u53d6\u64cd\u4f5c\u7684\u4f8b\u5b50\u3002</p> <pre><code class="language-javascript">var person = {\n  name: &quot;\u5f20\u4e09&quot;\n};\n\nvar proxy = new Proxy(person, {\n  get: function(target, property) {\n    if (property in target) {\n      return target[property];\n    } else {\n      throw new ReferenceError(&quot;Property \\&quot;&quot; + property + &quot;\\&quot; does not exist.&quot;);\n    }\n  }\n});\n\nproxy.name // &quot;\u5f20\u4e09&quot;\nproxy.age // \u629b\u51fa\u4e00\u4e2a\u9519\u8bef</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u8868\u793a\uff0c\u5982\u679c\u8bbf\u95ee\u76ee\u6807\u5bf9\u8c61\u4e0d\u5b58\u5728\u7684\u5c5e\u6027\uff0c\u4f1a\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\u3002\u5982\u679c\u6ca1\u6709\u8fd9\u4e2a\u62e6\u622a\u51fd\u6570\uff0c\u8bbf\u95ee\u4e0d\u5b58\u5728\u7684\u5c5e\u6027\uff0c\u53ea\u4f1a\u8fd4\u56de<code>undefined</code>\u3002</p> <p><code>get</code>\u65b9\u6cd5\u53ef\u4ee5\u7ee7\u627f\u3002</p> <pre><code class="language-javascript">let proto = new Proxy({}, {\n  get(target, propertyKey, receiver) {\n    console.log(&#39;GET &#39; + propertyKey);\n    return target[propertyKey];\n  }\n});\n\nlet obj = Object.create(proto);\nobj.foo // &quot;GET foo&quot;</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c\u62e6\u622a\u64cd\u4f5c\u5b9a\u4e49\u5728<code>Prototype</code>\u5bf9\u8c61\u4e0a\u9762\uff0c\u6240\u4ee5\u5982\u679c\u8bfb\u53d6<code>obj</code>\u5bf9\u8c61\u7ee7\u627f\u7684\u5c5e\u6027\u65f6\uff0c\u62e6\u622a\u4f1a\u751f\u6548\u3002</p> <p>\u4e0b\u9762\u7684\u4f8b\u5b50\u4f7f\u7528<code>get</code>\u62e6\u622a\uff0c\u5b9e\u73b0\u6570\u7ec4\u8bfb\u53d6\u8d1f\u6570\u7684\u7d22\u5f15\u3002</p> <pre><code class="language-javascript">function createArray(...elements) {\n  let handler = {\n    get(target, propKey, receiver) {\n      let index = Number(propKey);\n      if (index &lt; 0) {\n        propKey = String(target.length + index);\n      }\n      return Reflect.get(target, propKey, receiver);\n    }\n  };\n\n  let target = [];\n  target.push(...elements);\n  return new Proxy(target, handler);\n}\n\nlet arr = createArray(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;);\narr[-1] // c</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c\u6570\u7ec4\u7684\u4f4d\u7f6e\u53c2\u6570\u662f<code>-1</code>\uff0c\u5c31\u4f1a\u8f93\u51fa\u6570\u7ec4\u7684\u5012\u6570\u6700\u540e\u4e00\u4e2a\u6210\u5458\u3002</p> <p>\u5229\u7528 Proxy\uff0c\u53ef\u4ee5\u5c06\u8bfb\u53d6\u5c5e\u6027\u7684\u64cd\u4f5c\uff08<code>get</code>\uff09\uff0c\u8f6c\u53d8\u4e3a\u6267\u884c\u67d0\u4e2a\u51fd\u6570\uff0c\u4ece\u800c\u5b9e\u73b0\u5c5e\u6027\u7684\u94fe\u5f0f\u64cd\u4f5c\u3002</p> <pre><code class="language-javascript">var pipe = (function () {\n  return function (value) {\n    var funcStack = [];\n    var oproxy = new Proxy({} , {\n      get : function (pipeObject, fnName) {\n        if (fnName === &#39;get&#39;) {\n          return funcStack.reduce(function (val, fn) {\n            return fn(val);\n          },value);\n        }\n        funcStack.push(window[fnName]);\n        return oproxy;\n      }\n    });\n\n    return oproxy;\n  }\n}());\n\nvar double = n =&gt; n * 2;\nvar pow    = n =&gt; n * n;\nvar reverseInt = n =&gt; n.toString().split(&quot;&quot;).reverse().join(&quot;&quot;) | 0;\n\npipe(3).double.pow.reverseInt.get; // 63</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u8bbe\u7f6e Proxy \u4ee5\u540e\uff0c\u8fbe\u5230\u4e86\u5c06\u51fd\u6570\u540d\u94fe\u5f0f\u4f7f\u7528\u7684\u6548\u679c\u3002</p> <p>\u4e0b\u9762\u7684\u4f8b\u5b50\u5219\u662f\u5229\u7528<code>get</code>\u62e6\u622a\uff0c\u5b9e\u73b0\u4e00\u4e2a\u751f\u6210\u5404\u79cd DOM \u8282\u70b9\u7684\u901a\u7528\u51fd\u6570<code>dom</code>\u3002</p> <pre><code class="language-javascript">const dom = new Proxy({}, {\n  get(target, property) {\n    return function(attrs = {}, ...children) {\n      const el = document.createElement(property);\n      for (let prop of Object.keys(attrs)) {\n        el.setAttribute(prop, attrs[prop]);\n      }\n      for (let child of children) {\n        if (typeof child === &#39;string&#39;) {\n          child = document.createTextNode(child);\n        }\n        el.appendChild(child);\n      }\n      return el;\n    }\n  }\n});\n\nconst el = dom.div({},\n  &#39;Hello, my name is &#39;,\n  dom.a({href: &#39;//example.com&#39;}, &#39;Mark&#39;),\n  &#39;. I like:&#39;,\n  dom.ul({},\n    dom.li({}, &#39;The web&#39;),\n    dom.li({}, &#39;Food&#39;),\n    dom.li({}, &#39;\u2026actually that\\&#39;s it&#39;)\n  )\n);\n\ndocument.body.appendChild(el);</code></pre> <p>\u4e0b\u9762\u662f\u4e00\u4e2a<code>get</code>\u65b9\u6cd5\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\u7684\u4f8b\u5b50\u3002</p> <pre><code class="language-javascript">const proxy = new Proxy({}, {\n  get: function(target, property, receiver) {\n    return receiver;\n  }\n});\nproxy.getReceiver === proxy // true</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c<code>get</code>\u65b9\u6cd5\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570<code>receiver</code>\uff0c\u603b\u662f\u4e3a\u5f53\u524d\u7684 Proxy \u5b9e\u4f8b\u3002</p> <p>\u5982\u679c\u4e00\u4e2a\u5c5e\u6027\u4e0d\u53ef\u914d\u7f6e\uff08configurable\uff09\u548c\u4e0d\u53ef\u5199\uff08writable\uff09\uff0c\u5219\u8be5\u5c5e\u6027\u4e0d\u80fd\u88ab\u4ee3\u7406\uff0c\u901a\u8fc7 Proxy \u5bf9\u8c61\u8bbf\u95ee\u8be5\u5c5e\u6027\u4f1a\u62a5\u9519\u3002</p> <pre><code class="language-javascript">const target = Object.defineProperties({}, {\n  foo: {\n    value: 123,\n    writable: false,\n    configurable: false\n  },\n});\n\nconst handler = {\n  get(target, propKey) {\n    return &#39;abc&#39;;\n  }\n};\n\nconst proxy = new Proxy(target, handler);\n\nproxy.foo\n// TypeError: Invariant check failed</code></pre> <h3 id="set">set()</h3> <p><code>set</code>\u65b9\u6cd5\u7528\u6765\u62e6\u622a\u67d0\u4e2a\u5c5e\u6027\u7684\u8d4b\u503c\u64cd\u4f5c\uff0c\u53ef\u4ee5\u63a5\u53d7\u56db\u4e2a\u53c2\u6570\uff0c\u4f9d\u6b21\u4e3a\u76ee\u6807\u5bf9\u8c61\u3001\u5c5e\u6027\u540d\u3001\u5c5e\u6027\u503c\u548c Proxy \u5b9e\u4f8b\u672c\u8eab\uff0c\u5176\u4e2d\u6700\u540e\u4e00\u4e2a\u53c2\u6570\u53ef\u9009\u3002</p> <p>\u5047\u5b9a<code>Person</code>\u5bf9\u8c61\u6709\u4e00\u4e2a<code>age</code>\u5c5e\u6027\uff0c\u8be5\u5c5e\u6027\u5e94\u8be5\u662f\u4e00\u4e2a\u4e0d\u5927\u4e8e 200 \u7684\u6574\u6570\uff0c\u90a3\u4e48\u53ef\u4ee5\u4f7f\u7528<code>Proxy</code>\u4fdd\u8bc1<code>age</code>\u7684\u5c5e\u6027\u503c\u7b26\u5408\u8981\u6c42\u3002</p> <pre><code class="language-javascript">let validator = {\n  set: function(obj, prop, value) {\n    if (prop === &#39;age&#39;) {\n      if (!Number.isInteger(value)) {\n        throw new TypeError(&#39;The age is not an integer&#39;);\n      }\n      if (value &gt; 200) {\n        throw new RangeError(&#39;The age seems invalid&#39;);\n      }\n    }\n\n    // \u5bf9\u4e8eage\u4ee5\u5916\u7684\u5c5e\u6027\uff0c\u76f4\u63a5\u4fdd\u5b58\n    obj[prop] = value;\n  }\n};\n\nlet person = new Proxy({}, validator);\n\nperson.age = 100;\n\nperson.age // 100\nperson.age = &#39;young&#39; // \u62a5\u9519\nperson.age = 300 // \u62a5\u9519</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c\u7531\u4e8e\u8bbe\u7f6e\u4e86\u5b58\u503c\u51fd\u6570<code>set</code>\uff0c\u4efb\u4f55\u4e0d\u7b26\u5408\u8981\u6c42\u7684<code>age</code>\u5c5e\u6027\u8d4b\u503c\uff0c\u90fd\u4f1a\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\uff0c\u8fd9\u662f\u6570\u636e\u9a8c\u8bc1\u7684\u4e00\u79cd\u5b9e\u73b0\u65b9\u6cd5\u3002\u5229\u7528<code>set</code>\u65b9\u6cd5\uff0c\u8fd8\u53ef\u4ee5\u6570\u636e\u7ed1\u5b9a\uff0c\u5373\u6bcf\u5f53\u5bf9\u8c61\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u4f1a\u81ea\u52a8\u66f4\u65b0 DOM\u3002</p> <p>\u6709\u65f6\uff0c\u6211\u4eec\u4f1a\u5728\u5bf9\u8c61\u4e0a\u9762\u8bbe\u7f6e\u5185\u90e8\u5c5e\u6027\uff0c\u5c5e\u6027\u540d\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4f7f\u7528\u4e0b\u5212\u7ebf\u5f00\u5934\uff0c\u8868\u793a\u8fd9\u4e9b\u5c5e\u6027\u4e0d\u5e94\u8be5\u88ab\u5916\u90e8\u4f7f\u7528\u3002\u7ed3\u5408<code>get</code>\u548c<code>set</code>\u65b9\u6cd5\uff0c\u5c31\u53ef\u4ee5\u505a\u5230\u9632\u6b62\u8fd9\u4e9b\u5185\u90e8\u5c5e\u6027\u88ab\u5916\u90e8\u8bfb\u5199\u3002</p> <pre><code class="language-javascript">const handler = {\n  get (target, key) {\n    invariant(key, &#39;get&#39;);\n    return target[key];\n  },\n  set (target, key, value) {\n    invariant(key, &#39;set&#39;);\n    target[key] = value;\n    return true;\n  }\n};\nfunction invariant (key, action) {\n  if (key[0] === &#39;_&#39;) {\n    throw new Error(`Invalid attempt to ${action} private &quot;${key}&quot; property`);\n  }\n}\nconst target = {};\nconst proxy = new Proxy(target, handler);\nproxy._prop\n// Error: Invalid attempt to get private &quot;_prop&quot; property\nproxy._prop = &#39;c&#39;\n// Error: Invalid attempt to set private &quot;_prop&quot; property</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c\u53ea\u8981\u8bfb\u5199\u7684\u5c5e\u6027\u540d\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u662f\u4e0b\u5212\u7ebf\uff0c\u4e00\u5f8b\u629b\u9519\uff0c\u4ece\u800c\u8fbe\u5230\u7981\u6b62\u8bfb\u5199\u5185\u90e8\u5c5e\u6027\u7684\u76ee\u7684\u3002</p> <p>\u4e0b\u9762\u662f<code>set</code>\u65b9\u6cd5\u7b2c\u56db\u4e2a\u53c2\u6570\u7684\u4f8b\u5b50\u3002</p> <pre><code class="language-javascript">const handler = {\n  set: function(obj, prop, value, receiver) {\n    obj[prop] = receiver;\n  }\n};\nconst proxy = new Proxy({}, handler);\nproxy.foo = &#39;bar&#39;;\nproxy.foo === proxy // true</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c<code>set</code>\u65b9\u6cd5\u7684\u7b2c\u56db\u4e2a\u53c2\u6570<code>receiver</code>\uff0c\u603b\u662f\u8fd4\u56de<code>this</code>\u5173\u952e\u5b57\u6240\u6307\u5411\u7684\u90a3\u4e2a\u5bf9\u8c61\uff0c\u5373<code>proxy</code>\u5b9e\u4f8b\u672c\u8eab\u3002</p> <p>\u6ce8\u610f\uff0c\u5982\u679c\u76ee\u6807\u5bf9\u8c61\u81ea\u8eab\u7684\u67d0\u4e2a\u5c5e\u6027\uff0c\u4e0d\u53ef\u5199\u4e5f\u4e0d\u53ef\u914d\u7f6e\uff0c\u90a3\u4e48<code>set</code>\u4e0d\u5f97\u6539\u53d8\u8fd9\u4e2a\u5c5e\u6027\u7684\u503c\uff0c\u53ea\u80fd\u8fd4\u56de\u540c\u6837\u7684\u503c\uff0c\u5426\u5219\u62a5\u9519\u3002</p> <h3 id="apply">apply()</h3> <p><code>apply</code>\u65b9\u6cd5\u62e6\u622a\u51fd\u6570\u7684\u8c03\u7528\u3001<code>call</code>\u548c<code>apply</code>\u64cd\u4f5c\u3002</p> <p><code>apply</code>\u65b9\u6cd5\u53ef\u4ee5\u63a5\u53d7\u4e09\u4e2a\u53c2\u6570\uff0c\u5206\u522b\u662f\u76ee\u6807\u5bf9\u8c61\u3001\u76ee\u6807\u5bf9\u8c61\u7684\u4e0a\u4e0b\u6587\u5bf9\u8c61\uff08<code>this</code>\uff09\u548c\u76ee\u6807\u5bf9\u8c61\u7684\u53c2\u6570\u6570\u7ec4\u3002</p> <pre><code class="language-javascript">var handler = {\n  apply (target, ctx, args) {\n    return Reflect.apply(...arguments);\n  }\n};</code></pre> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u4f8b\u5b50\u3002</p> <pre><code class="language-javascript">var target = function () { return &#39;I am the target&#39;; };\nvar handler = {\n  apply: function () {\n    return &#39;I am the proxy&#39;;\n  }\n};\n\nvar p = new Proxy(target, handler);\n\np()\n// &quot;I am the proxy&quot;</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c\u53d8\u91cf<code>p</code>\u662f Proxy \u7684\u5b9e\u4f8b\uff0c\u5f53\u5b83\u4f5c\u4e3a\u51fd\u6570\u8c03\u7528\u65f6\uff08<code>p()</code>\uff09\uff0c\u5c31\u4f1a\u88ab<code>apply</code>\u65b9\u6cd5\u62e6\u622a\uff0c\u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002</p> <p>\u4e0b\u9762\u662f\u53e6\u5916\u4e00\u4e2a\u4f8b\u5b50\u3002</p> <pre><code class="language-javascript">var twice = {\n  apply (target, ctx, args) {\n    return Reflect.apply(...arguments) * 2;\n  }\n};\nfunction sum (left, right) {\n  return left + right;\n};\nvar proxy = new Proxy(sum, twice);\nproxy(1, 2) // 6\nproxy.call(null, 5, 6) // 22\nproxy.apply(null, [7, 8]) // 30</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c\u6bcf\u5f53\u6267\u884c<code>proxy</code>\u51fd\u6570\uff08\u76f4\u63a5\u8c03\u7528\u6216<code>call</code>\u548c<code>apply</code>\u8c03\u7528\uff09\uff0c\u5c31\u4f1a\u88ab<code>apply</code>\u65b9\u6cd5\u62e6\u622a\u3002</p> <p>\u53e6\u5916\uff0c\u76f4\u63a5\u8c03\u7528<code>Reflect.apply</code>\u65b9\u6cd5\uff0c\u4e5f\u4f1a\u88ab\u62e6\u622a\u3002</p> <pre><code class="language-javascript">Reflect.apply(proxy, null, [9, 10]) // 38</code></pre> <h3 id="has">has()</h3> <p><code>has</code>\u65b9\u6cd5\u7528\u6765\u62e6\u622a<code>HasProperty</code>\u64cd\u4f5c\uff0c\u5373\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u5177\u6709\u67d0\u4e2a\u5c5e\u6027\u65f6\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u751f\u6548\u3002\u5178\u578b\u7684\u64cd\u4f5c\u5c31\u662f<code>in</code>\u8fd0\u7b97\u7b26\u3002</p> <p>\u4e0b\u9762\u7684\u4f8b\u5b50\u4f7f\u7528<code>has</code>\u65b9\u6cd5\u9690\u85cf\u67d0\u4e9b\u5c5e\u6027\uff0c\u4e0d\u88ab<code>in</code>\u8fd0\u7b97\u7b26\u53d1\u73b0\u3002</p> <pre><code class="language-javascript">var handler = {\n  has (target, key) {\n    if (key[0] === &#39;_&#39;) {\n      return false;\n    }\n    return key in target;\n  }\n};\nvar target = { _prop: &#39;foo&#39;, prop: &#39;foo&#39; };\nvar proxy = new Proxy(target, handler);\n&#39;_prop&#39; in proxy // false</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c\u5982\u679c\u539f\u5bf9\u8c61\u7684\u5c5e\u6027\u540d\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u662f\u4e0b\u5212\u7ebf\uff0c<code>proxy.has</code>\u5c31\u4f1a\u8fd4\u56de<code>false</code>\uff0c\u4ece\u800c\u4e0d\u4f1a\u88ab<code>in</code>\u8fd0\u7b97\u7b26\u53d1\u73b0\u3002</p> <p>\u5982\u679c\u539f\u5bf9\u8c61\u4e0d\u53ef\u914d\u7f6e\u6216\u8005\u7981\u6b62\u6269\u5c55\uff0c\u8fd9\u65f6<code>has</code>\u62e6\u622a\u4f1a\u62a5\u9519\u3002</p> <pre><code class="language-javascript">var obj = { a: 10 };\nObject.preventExtensions(obj);\n\nvar p = new Proxy(obj, {\n  has: function(target, prop) {\n    return false;\n  }\n});\n\n&#39;a&#39; in p // TypeError is thrown</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c<code>obj</code>\u5bf9\u8c61\u7981\u6b62\u6269\u5c55\uff0c\u7ed3\u679c\u4f7f\u7528<code>has</code>\u62e6\u622a\u5c31\u4f1a\u62a5\u9519\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u67d0\u4e2a\u5c5e\u6027\u4e0d\u53ef\u914d\u7f6e\uff08\u6216\u8005\u76ee\u6807\u5bf9\u8c61\u4e0d\u53ef\u6269\u5c55\uff09\uff0c\u5219<code>has</code>\u65b9\u6cd5\u5c31\u4e0d\u5f97\u201c\u9690\u85cf\u201d\uff08\u5373\u8fd4\u56de<code>false</code>\uff09\u76ee\u6807\u5bf9\u8c61\u7684\u8be5\u5c5e\u6027\u3002</p> <p>\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c<code>has</code>\u65b9\u6cd5\u62e6\u622a\u7684\u662f<code>HasProperty</code>\u64cd\u4f5c\uff0c\u800c\u4e0d\u662f<code>HasOwnProperty</code>\u64cd\u4f5c\uff0c\u5373<code>has</code>\u65b9\u6cd5\u4e0d\u5224\u65ad\u4e00\u4e2a\u5c5e\u6027\u662f\u5bf9\u8c61\u81ea\u8eab\u7684\u5c5e\u6027\uff0c\u8fd8\u662f\u7ee7\u627f\u7684\u5c5e\u6027\u3002</p> <p>\u53e6\u5916\uff0c\u867d\u7136<code>for...in</code>\u5faa\u73af\u4e5f\u7528\u5230\u4e86<code>in</code>\u8fd0\u7b97\u7b26\uff0c\u4f46\u662f<code>has</code>\u62e6\u622a\u5bf9<code>for...in</code>\u5faa\u73af\u4e0d\u751f\u6548\u3002</p> <pre><code class="language-javascript">let stu1 = {name: &#39;\u5f20\u4e09&#39;, score: 59};\nlet stu2 = {name: &#39;\u674e\u56db&#39;, score: 99};\n\nlet handler = {\n  has(target, prop) {\n    if (prop === &#39;score&#39; &amp;&amp; target[prop] &lt; 60) {\n      console.log(`${target.name} \u4e0d\u53ca\u683c`);\n      return false;\n    }\n    return prop in target;\n  }\n}\n\nlet oproxy1 = new Proxy(stu1, handler);\nlet oproxy2 = new Proxy(stu2, handler);\n\n&#39;score&#39; in oproxy1\n// \u5f20\u4e09 \u4e0d\u53ca\u683c\n// false\n\n&#39;score&#39; in oproxy2\n// true\n\nfor (let a in oproxy1) {\n  console.log(oproxy1[a]);\n}\n// \u5f20\u4e09\n// 59\n\nfor (let b in oproxy2) {\n  console.log(oproxy2[b]);\n}\n// \u674e\u56db\n// 99</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c<code>has</code>\u62e6\u622a\u53ea\u5bf9<code>in</code>\u5faa\u73af\u751f\u6548\uff0c\u5bf9<code>for...in</code>\u5faa\u73af\u4e0d\u751f\u6548\uff0c\u5bfc\u81f4\u4e0d\u7b26\u5408\u8981\u6c42\u7684\u5c5e\u6027\u6ca1\u6709\u88ab\u6392\u9664\u5728<code>for...in</code>\u5faa\u73af\u4e4b\u5916\u3002</p> <h3 id="construct">construct()</h3> <p><code>construct</code>\u65b9\u6cd5\u7528\u4e8e\u62e6\u622a<code>new</code>\u547d\u4ee4\uff0c\u4e0b\u9762\u662f\u62e6\u622a\u5bf9\u8c61\u7684\u5199\u6cd5\u3002</p> <pre><code class="language-javascript">var handler = {\n  construct (target, args, newTarget) {\n    return new target(...args);\n  }\n};</code></pre> <p><code>construct</code>\u65b9\u6cd5\u53ef\u4ee5\u63a5\u53d7\u4e24\u4e2a\u53c2\u6570\u3002</p> <ul> <li><code>target</code>: \u76ee\u6807\u5bf9\u8c61</li> <li><code>args</code>\uff1a\u6784\u5efa\u51fd\u6570\u7684\u53c2\u6570\u5bf9\u8c61</li> </ul> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u4f8b\u5b50\u3002</p> <pre><code class="language-javascript">var p = new Proxy(function () {}, {\n  construct: function(target, args) {\n    console.log(&#39;called: &#39; + args.join(&#39;, &#39;));\n    return { value: args[0] * 10 };\n  }\n});\n\n(new p(1)).value\n// &quot;called: 1&quot;\n// 10</code></pre> <p><code>construct</code>\u65b9\u6cd5\u8fd4\u56de\u7684\u5fc5\u987b\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5426\u5219\u4f1a\u62a5\u9519\u3002</p> <pre><code class="language-javascript">var p = new Proxy(function() {}, {\n  construct: function(target, argumentsList) {\n    return 1;\n  }\n});\n\nnew p() // \u62a5\u9519</code></pre> <h3 id="deleteproperty">deleteProperty()</h3> <p><code>deleteProperty</code>\u65b9\u6cd5\u7528\u4e8e\u62e6\u622a<code>delete</code>\u64cd\u4f5c\uff0c\u5982\u679c\u8fd9\u4e2a\u65b9\u6cd5\u629b\u51fa\u9519\u8bef\u6216\u8005\u8fd4\u56de<code>false</code>\uff0c\u5f53\u524d\u5c5e\u6027\u5c31\u65e0\u6cd5\u88ab<code>delete</code>\u547d\u4ee4\u5220\u9664\u3002</p> <pre><code class="language-javascript">var handler = {\n  deleteProperty (target, key) {\n    invariant(key, &#39;delete&#39;);\n    return true;\n  }\n};\nfunction invariant (key, action) {\n  if (key[0] === &#39;_&#39;) {\n    throw new Error(`Invalid attempt to ${action} private &quot;${key}&quot; property`);\n  }\n}\n\nvar target = { _prop: &#39;foo&#39; };\nvar proxy = new Proxy(target, handler);\ndelete proxy._prop\n// Error: Invalid attempt to delete private &quot;_prop&quot; property</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c<code>deleteProperty</code>\u65b9\u6cd5\u62e6\u622a\u4e86<code>delete</code>\u64cd\u4f5c\u7b26\uff0c\u5220\u9664\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e3a\u4e0b\u5212\u7ebf\u7684\u5c5e\u6027\u4f1a\u62a5\u9519\u3002</p> <p>\u6ce8\u610f\uff0c\u76ee\u6807\u5bf9\u8c61\u81ea\u8eab\u7684\u4e0d\u53ef\u914d\u7f6e\uff08configurable\uff09\u7684\u5c5e\u6027\uff0c\u4e0d\u80fd\u88ab<code>deleteProperty</code>\u65b9\u6cd5\u5220\u9664\uff0c\u5426\u5219\u62a5\u9519\u3002</p> <h3 id="defineproperty">defineProperty()</h3> <p><code>defineProperty</code>\u65b9\u6cd5\u62e6\u622a\u4e86<code>Object.defineProperty</code>\u64cd\u4f5c\u3002</p> <pre><code class="language-javascript">var handler = {\n  defineProperty (target, key, descriptor) {\n    return false;\n  }\n};\nvar target = {};\nvar proxy = new Proxy(target, handler);\nproxy.foo = &#39;bar&#39;\n// TypeError: proxy defineProperty handler returned false for property &#39;&quot;foo&quot;&#39;</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c<code>defineProperty</code>\u65b9\u6cd5\u8fd4\u56de<code>false</code>\uff0c\u5bfc\u81f4\u6dfb\u52a0\u65b0\u5c5e\u6027\u4f1a\u629b\u51fa\u9519\u8bef\u3002</p> <p>\u6ce8\u610f\uff0c\u5982\u679c\u76ee\u6807\u5bf9\u8c61\u4e0d\u53ef\u6269\u5c55\uff08extensible\uff09\uff0c\u5219<code>defineProperty</code>\u4e0d\u80fd\u589e\u52a0\u76ee\u6807\u5bf9\u8c61\u4e0a\u4e0d\u5b58\u5728\u7684\u5c5e\u6027\uff0c\u5426\u5219\u4f1a\u62a5\u9519\u3002\u53e6\u5916\uff0c\u5982\u679c\u76ee\u6807\u5bf9\u8c61\u7684\u67d0\u4e2a\u5c5e\u6027\u4e0d\u53ef\u5199\uff08writable\uff09\u6216\u4e0d\u53ef\u914d\u7f6e\uff08configurable\uff09\uff0c\u5219<code>defineProperty</code>\u65b9\u6cd5\u4e0d\u5f97\u6539\u53d8\u8fd9\u4e24\u4e2a\u8bbe\u7f6e\u3002</p> <h3 id="getownpropertydescriptor">getOwnPropertyDescriptor()</h3> <p><code>getOwnPropertyDescriptor</code>\u65b9\u6cd5\u62e6\u622a<code>Object.getOwnPropertyDescriptor()</code>\uff0c\u8fd4\u56de\u4e00\u4e2a\u5c5e\u6027\u63cf\u8ff0\u5bf9\u8c61\u6216\u8005<code>undefined</code>\u3002</p> <pre><code class="language-javascript">var handler = {\n  getOwnPropertyDescriptor (target, key) {\n    if (key[0] === &#39;_&#39;) {\n      return;\n    }\n    return Object.getOwnPropertyDescriptor(target, key);\n  }\n};\nvar target = { _foo: &#39;bar&#39;, baz: &#39;tar&#39; };\nvar proxy = new Proxy(target, handler);\nObject.getOwnPropertyDescriptor(proxy, &#39;wat&#39;)\n// undefined\nObject.getOwnPropertyDescriptor(proxy, &#39;_foo&#39;)\n// undefined\nObject.getOwnPropertyDescriptor(proxy, &#39;baz&#39;)\n// { value: &#39;tar&#39;, writable: true, enumerable: true, configurable: true }</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c<code>handler.getOwnPropertyDescriptor</code>\u65b9\u6cd5\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e3a\u4e0b\u5212\u7ebf\u7684\u5c5e\u6027\u540d\u4f1a\u8fd4\u56de<code>undefined</code>\u3002</p> <h3 id="getprototypeof">getPrototypeOf()</h3> <p><code>getPrototypeOf</code>\u65b9\u6cd5\u4e3b\u8981\u7528\u6765\u62e6\u622a\u83b7\u53d6\u5bf9\u8c61\u539f\u578b\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u62e6\u622a\u4e0b\u9762\u8fd9\u4e9b\u64cd\u4f5c\u3002</p> <ul> <li><code>Object.prototype.__proto__</code></li> <li><code>Object.prototype.isPrototypeOf()</code></li> <li><code>Object.getPrototypeOf()</code></li> <li><code>Reflect.getPrototypeOf()</code></li> <li><code>instanceof</code></li> </ul> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u4f8b\u5b50\u3002</p> <pre><code class="language-javascript">var proto = {};\nvar p = new Proxy({}, {\n  getPrototypeOf(target) {\n    return proto;\n  }\n});\nObject.getPrototypeOf(p) === proto // true</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c<code>getPrototypeOf</code>\u65b9\u6cd5\u62e6\u622a<code>Object.getPrototypeOf()</code>\uff0c\u8fd4\u56de<code>proto</code>\u5bf9\u8c61\u3002</p> <p>\u6ce8\u610f\uff0c<code>getPrototypeOf</code>\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u5fc5\u987b\u662f\u5bf9\u8c61\u6216\u8005<code>null</code>\uff0c\u5426\u5219\u62a5\u9519\u3002\u53e6\u5916\uff0c\u5982\u679c\u76ee\u6807\u5bf9\u8c61\u4e0d\u53ef\u6269\u5c55\uff08extensible\uff09\uff0c <code>getPrototypeOf</code>\u65b9\u6cd5\u5fc5\u987b\u8fd4\u56de\u76ee\u6807\u5bf9\u8c61\u7684\u539f\u578b\u5bf9\u8c61\u3002</p> <h3 id="isextensible">isExtensible()</h3> <p><code>isExtensible</code>\u65b9\u6cd5\u62e6\u622a<code>Object.isExtensible</code>\u64cd\u4f5c\u3002</p> <pre><code class="language-javascript">var p = new Proxy({}, {\n  isExtensible: function(target) {\n    console.log(&quot;called&quot;);\n    return true;\n  }\n});\n\nObject.isExtensible(p)\n// &quot;called&quot;\n// true</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u8bbe\u7f6e\u4e86<code>isExtensible</code>\u65b9\u6cd5\uff0c\u5728\u8c03\u7528<code>Object.isExtensible</code>\u65f6\u4f1a\u8f93\u51fa<code>called</code>\u3002</p> <p>\u6ce8\u610f\uff0c\u8be5\u65b9\u6cd5\u53ea\u80fd\u8fd4\u56de\u5e03\u5c14\u503c\uff0c\u5426\u5219\u8fd4\u56de\u503c\u4f1a\u88ab\u81ea\u52a8\u8f6c\u4e3a\u5e03\u5c14\u503c\u3002</p> <p>\u8fd9\u4e2a\u65b9\u6cd5\u6709\u4e00\u4e2a\u5f3a\u9650\u5236\uff0c\u5b83\u7684\u8fd4\u56de\u503c\u5fc5\u987b\u4e0e\u76ee\u6807\u5bf9\u8c61\u7684<code>isExtensible</code>\u5c5e\u6027\u4fdd\u6301\u4e00\u81f4\uff0c\u5426\u5219\u5c31\u4f1a\u629b\u51fa\u9519\u8bef\u3002</p> <pre><code class="language-javascript">Object.isExtensible(proxy) === Object.isExtensible(target)</code></pre> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u4f8b\u5b50\u3002</p> <pre><code class="language-javascript">var p = new Proxy({}, {\n  isExtensible: function(target) {\n    return false;\n  }\n});\n\nObject.isExtensible(p) // \u62a5\u9519</code></pre> <h3 id="ownkeys">ownKeys()</h3> <p><code>ownKeys</code>\u65b9\u6cd5\u7528\u6765\u62e6\u622a\u5bf9\u8c61\u81ea\u8eab\u5c5e\u6027\u7684\u8bfb\u53d6\u64cd\u4f5c\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u62e6\u622a\u4ee5\u4e0b\u64cd\u4f5c\u3002</p> <ul> <li><code>Object.getOwnPropertyNames()</code></li> <li><code>Object.getOwnPropertySymbols()</code></li> <li><code>Object.keys()</code></li> </ul> <p>\u4e0b\u9762\u662f\u62e6\u622a<code>Object.keys()</code>\u7684\u4f8b\u5b50\u3002</p> <pre><code class="language-javascript">let target = {\n  a: 1,\n  b: 2,\n  c: 3\n};\n\nlet handler = {\n  ownKeys(target) {\n    return [&#39;a&#39;];\n  }\n};\n\nlet proxy = new Proxy(target, handler);\n\nObject.keys(proxy)\n// [ &#39;a&#39; ]</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u62e6\u622a\u4e86\u5bf9\u4e8e<code>target</code>\u5bf9\u8c61\u7684<code>Object.keys()</code>\u64cd\u4f5c\uff0c\u53ea\u8fd4\u56de<code>a</code>\u3001<code>b</code>\u3001<code>c</code>\u4e09\u4e2a\u5c5e\u6027\u4e4b\u4e2d\u7684<code>a</code>\u5c5e\u6027\u3002</p> <p>\u4e0b\u9762\u7684\u4f8b\u5b50\u662f\u62e6\u622a\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e3a\u4e0b\u5212\u7ebf\u7684\u5c5e\u6027\u540d\u3002</p> <pre><code class="language-javascript">let target = {\n  _bar: &#39;foo&#39;,\n  _prop: &#39;bar&#39;,\n  prop: &#39;baz&#39;\n};\n\nlet handler = {\n  ownKeys (target) {\n    return Reflect.ownKeys(target).filter(key =&gt; key[0] !== &#39;_&#39;);\n  }\n};\n\nlet proxy = new Proxy(target, handler);\nfor (let key of Object.keys(proxy)) {\n  console.log(target[key]);\n}\n// &quot;baz&quot;</code></pre> <p>\u6ce8\u610f\uff0c\u4f7f\u7528<code>Object.keys</code>\u65b9\u6cd5\u65f6\uff0c\u6709\u4e09\u7c7b\u5c5e\u6027\u4f1a\u88ab<code>ownKeys</code>\u65b9\u6cd5\u81ea\u52a8\u8fc7\u6ee4\uff0c\u4e0d\u4f1a\u8fd4\u56de\u3002</p> <ul> <li>\u76ee\u6807\u5bf9\u8c61\u4e0a\u4e0d\u5b58\u5728\u7684\u5c5e\u6027</li> <li>\u5c5e\u6027\u540d\u4e3a Symbol \u503c</li> <li>\u4e0d\u53ef\u904d\u5386\uff08<code>enumerable</code>\uff09\u7684\u5c5e\u6027</li> </ul> <pre><code class="language-javascript">let target = {\n  a: 1,\n  b: 2,\n  c: 3,\n  [Symbol.for(&#39;secret&#39;)]: &#39;4&#39;,\n};\n\nObject.defineProperty(target, &#39;key&#39;, {\n  enumerable: false,\n  configurable: true,\n  writable: true,\n  value: &#39;static&#39;\n});\n\nlet handler = {\n  ownKeys(target) {\n    return [&#39;a&#39;, &#39;d&#39;, Symbol.for(&#39;secret&#39;), &#39;key&#39;];\n  }\n};\n\nlet proxy = new Proxy(target, handler);\n\nObject.keys(proxy)\n// [&#39;a&#39;]</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c<code>ownKeys</code>\u65b9\u6cd5\u4e4b\u4e2d\uff0c\u663e\u5f0f\u8fd4\u56de\u4e0d\u5b58\u5728\u7684\u5c5e\u6027\uff08<code>d</code>\uff09\u3001Symbol \u503c\uff08<code>Symbol.for(&#39;secret&#39;)</code>\uff09\u3001\u4e0d\u53ef\u904d\u5386\u7684\u5c5e\u6027\uff08<code>key</code>\uff09\uff0c\u7ed3\u679c\u90fd\u88ab\u81ea\u52a8\u8fc7\u6ee4\u6389\u3002</p> <p><code>ownKeys</code>\u65b9\u6cd5\u8fd8\u53ef\u4ee5\u62e6\u622a<code>Object.getOwnPropertyNames()</code>\u3002</p> <pre><code class="language-javascript">var p = new Proxy({}, {\n  ownKeys: function(target) {\n    return [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;];\n  }\n});\n\nObject.getOwnPropertyNames(p)\n// [ &#39;a&#39;, &#39;b&#39;, &#39;c&#39; ]</code></pre> <p><code>ownKeys</code>\u65b9\u6cd5\u8fd4\u56de\u7684\u6570\u7ec4\u6210\u5458\uff0c\u53ea\u80fd\u662f\u5b57\u7b26\u4e32\u6216 Symbol \u503c\u3002\u5982\u679c\u6709\u5176\u4ed6\u7c7b\u578b\u7684\u503c\uff0c\u6216\u8005\u8fd4\u56de\u7684\u6839\u672c\u4e0d\u662f\u6570\u7ec4\uff0c\u5c31\u4f1a\u62a5\u9519\u3002</p> <pre><code class="language-javascript">var obj = {};\n\nvar p = new Proxy(obj, {\n  ownKeys: function(target) {\n    return [123, true, undefined, null, {}, []];\n  }\n});\n\nObject.getOwnPropertyNames(p)\n// Uncaught TypeError: 123 is not a valid property name</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c<code>ownKeys</code>\u65b9\u6cd5\u867d\u7136\u8fd4\u56de\u4e00\u4e2a\u6570\u7ec4\uff0c\u4f46\u662f\u6bcf\u4e00\u4e2a\u6570\u7ec4\u6210\u5458\u90fd\u4e0d\u662f\u5b57\u7b26\u4e32\u6216 Symbol \u503c\uff0c\u56e0\u6b64\u5c31\u62a5\u9519\u4e86\u3002</p> <p>\u5982\u679c\u76ee\u6807\u5bf9\u8c61\u81ea\u8eab\u5305\u542b\u4e0d\u53ef\u914d\u7f6e\u7684\u5c5e\u6027\uff0c\u5219\u8be5\u5c5e\u6027\u5fc5\u987b\u88ab<code>ownKeys</code>\u65b9\u6cd5\u8fd4\u56de\uff0c\u5426\u5219\u62a5\u9519\u3002</p> <pre><code class="language-javascript">var obj = {};\nObject.defineProperty(obj, &#39;a&#39;, {\n  configurable: false,\n  enumerable: true,\n  value: 10 }\n);\n\nvar p = new Proxy(obj, {\n  ownKeys: function(target) {\n    return [&#39;b&#39;];\n  }\n});\n\nObject.getOwnPropertyNames(p)\n// Uncaught TypeError: &#39;ownKeys&#39; on proxy: trap result did not include &#39;a&#39;</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c<code>obj</code>\u5bf9\u8c61\u7684<code>a</code>\u5c5e\u6027\u662f\u4e0d\u53ef\u914d\u7f6e\u7684\uff0c\u8fd9\u65f6<code>ownKeys</code>\u65b9\u6cd5\u8fd4\u56de\u7684\u6570\u7ec4\u4e4b\u4e2d\uff0c\u5fc5\u987b\u5305\u542b<code>a</code>\uff0c\u5426\u5219\u4f1a\u62a5\u9519\u3002</p> <p>\u53e6\u5916\uff0c\u5982\u679c\u76ee\u6807\u5bf9\u8c61\u662f\u4e0d\u53ef\u6269\u5c55\u7684\uff08non-extensition\uff09\uff0c\u8fd9\u65f6<code>ownKeys</code>\u65b9\u6cd5\u8fd4\u56de\u7684\u6570\u7ec4\u4e4b\u4e2d\uff0c\u5fc5\u987b\u5305\u542b\u539f\u5bf9\u8c61\u7684\u6240\u6709\u5c5e\u6027\uff0c\u4e14\u4e0d\u80fd\u5305\u542b\u591a\u4f59\u7684\u5c5e\u6027\uff0c\u5426\u5219\u62a5\u9519\u3002</p> <pre><code class="language-javascript">var obj = {\n  a: 1\n};\n\nObject.preventExtensions(obj);\n\nvar p = new Proxy(obj, {\n  ownKeys: function(target) {\n    return [&#39;a&#39;, &#39;b&#39;];\n  }\n});\n\nObject.getOwnPropertyNames(p)\n// Uncaught TypeError: &#39;ownKeys&#39; on proxy: trap returned extra keys but proxy target is non-extensible</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c<code>obj</code>\u5bf9\u8c61\u662f\u4e0d\u53ef\u6269\u5c55\u7684\uff0c\u8fd9\u65f6<code>ownKeys</code>\u65b9\u6cd5\u8fd4\u56de\u7684\u6570\u7ec4\u4e4b\u4e2d\uff0c\u5305\u542b\u4e86<code>obj</code>\u5bf9\u8c61\u7684\u591a\u4f59\u5c5e\u6027<code>b</code>\uff0c\u6240\u4ee5\u5bfc\u81f4\u4e86\u62a5\u9519\u3002</p> <h3 id="preventextensions">preventExtensions()</h3> <p><code>preventExtensions</code>\u65b9\u6cd5\u62e6\u622a<code>Object.preventExtensions()</code>\u3002\u8be5\u65b9\u6cd5\u5fc5\u987b\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u5426\u5219\u4f1a\u88ab\u81ea\u52a8\u8f6c\u4e3a\u5e03\u5c14\u503c\u3002</p> <p>\u8fd9\u4e2a\u65b9\u6cd5\u6709\u4e00\u4e2a\u9650\u5236\uff0c\u53ea\u6709\u76ee\u6807\u5bf9\u8c61\u4e0d\u53ef\u6269\u5c55\u65f6\uff08\u5373<code>Object.isExtensible(proxy)</code>\u4e3a<code>false</code>\uff09\uff0c<code>proxy.preventExtensions</code>\u624d\u80fd\u8fd4\u56de<code>true</code>\uff0c\u5426\u5219\u4f1a\u62a5\u9519\u3002</p> <pre><code class="language-javascript">var p = new Proxy({}, {\n  preventExtensions: function(target) {\n    return true;\n  }\n});\n\nObject.preventExtensions(p) // \u62a5\u9519</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c<code>proxy.preventExtensions</code>\u65b9\u6cd5\u8fd4\u56de<code>true</code>\uff0c\u4f46\u8fd9\u65f6<code>Object.isExtensible(proxy)</code>\u4f1a\u8fd4\u56de<code>true</code>\uff0c\u56e0\u6b64\u62a5\u9519\u3002</p> <p>\u4e3a\u4e86\u9632\u6b62\u51fa\u73b0\u8fd9\u4e2a\u95ee\u9898\uff0c\u901a\u5e38\u8981\u5728<code>proxy.preventExtensions</code>\u65b9\u6cd5\u91cc\u9762\uff0c\u8c03\u7528\u4e00\u6b21<code>Object.preventExtensions</code>\u3002</p> <pre><code class="language-javascript">var p = new Proxy({}, {\n  preventExtensions: function(target) {\n    console.log(&#39;called&#39;);\n    Object.preventExtensions(target);\n    return true;\n  }\n});\n\nObject.preventExtensions(p)\n// &quot;called&quot;\n// true</code></pre> <h3 id="setprototypeof">setPrototypeOf()</h3> <p><code>setPrototypeOf</code>\u65b9\u6cd5\u4e3b\u8981\u7528\u6765\u62e6\u622a<code>Object.setPrototypeOf</code>\u65b9\u6cd5\u3002</p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u4f8b\u5b50\u3002</p> <pre><code class="language-javascript">var handler = {\n  setPrototypeOf (target, proto) {\n    throw new Error(&#39;Changing the prototype is forbidden&#39;);\n  }\n};\nvar proto = {};\nvar target = function () {};\nvar proxy = new Proxy(target, handler);\nObject.setPrototypeOf(proxy, proto);\n// Error: Changing the prototype is forbidden</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c\u53ea\u8981\u4fee\u6539<code>target</code>\u7684\u539f\u578b\u5bf9\u8c61\uff0c\u5c31\u4f1a\u62a5\u9519\u3002</p> <p>\u6ce8\u610f\uff0c\u8be5\u65b9\u6cd5\u53ea\u80fd\u8fd4\u56de\u5e03\u5c14\u503c\uff0c\u5426\u5219\u4f1a\u88ab\u81ea\u52a8\u8f6c\u4e3a\u5e03\u5c14\u503c\u3002\u53e6\u5916\uff0c\u5982\u679c\u76ee\u6807\u5bf9\u8c61\u4e0d\u53ef\u6269\u5c55\uff08extensible\uff09\uff0c<code>setPrototypeOf</code>\u65b9\u6cd5\u4e0d\u5f97\u6539\u53d8\u76ee\u6807\u5bf9\u8c61\u7684\u539f\u578b\u3002</p> <h2 id="proxyrevocable">Proxy.revocable()</h2> <p><code>Proxy.revocable</code>\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a\u53ef\u53d6\u6d88\u7684 Proxy \u5b9e\u4f8b\u3002</p> <pre><code class="language-javascript">let target = {};\nlet handler = {};\n\nlet {proxy, revoke} = Proxy.revocable(target, handler);\n\nproxy.foo = 123;\nproxy.foo // 123\n\nrevoke();\nproxy.foo // TypeError: Revoked</code></pre> <p><code>Proxy.revocable</code>\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u7684<code>proxy</code>\u5c5e\u6027\u662f<code>Proxy</code>\u5b9e\u4f8b\uff0c<code>revoke</code>\u5c5e\u6027\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u53ef\u4ee5\u53d6\u6d88<code>Proxy</code>\u5b9e\u4f8b\u3002\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c\u5f53\u6267\u884c<code>revoke</code>\u51fd\u6570\u4e4b\u540e\uff0c\u518d\u8bbf\u95ee<code>Proxy</code>\u5b9e\u4f8b\uff0c\u5c31\u4f1a\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\u3002</p> <p><code>Proxy.revocable</code>\u7684\u4e00\u4e2a\u4f7f\u7528\u573a\u666f\u662f\uff0c\u76ee\u6807\u5bf9\u8c61\u4e0d\u5141\u8bb8\u76f4\u63a5\u8bbf\u95ee\uff0c\u5fc5\u987b\u901a\u8fc7\u4ee3\u7406\u8bbf\u95ee\uff0c\u4e00\u65e6\u8bbf\u95ee\u7ed3\u675f\uff0c\u5c31\u6536\u56de\u4ee3\u7406\u6743\uff0c\u4e0d\u5141\u8bb8\u518d\u6b21\u8bbf\u95ee\u3002</p> <h2 id="this-\u95ee\u9898">this \u95ee\u9898</h2> <p>\u867d\u7136 Proxy \u53ef\u4ee5\u4ee3\u7406\u9488\u5bf9\u76ee\u6807\u5bf9\u8c61\u7684\u8bbf\u95ee\uff0c\u4f46\u5b83\u4e0d\u662f\u76ee\u6807\u5bf9\u8c61\u7684\u900f\u660e\u4ee3\u7406\uff0c\u5373\u4e0d\u505a\u4efb\u4f55\u62e6\u622a\u7684\u60c5\u51b5\u4e0b\uff0c\u4e5f\u65e0\u6cd5\u4fdd\u8bc1\u4e0e\u76ee\u6807\u5bf9\u8c61\u7684\u884c\u4e3a\u4e00\u81f4\u3002\u4e3b\u8981\u539f\u56e0\u5c31\u662f\u5728 Proxy \u4ee3\u7406\u7684\u60c5\u51b5\u4e0b\uff0c\u76ee\u6807\u5bf9\u8c61\u5185\u90e8\u7684<code>this</code>\u5173\u952e\u5b57\u4f1a\u6307\u5411 Proxy \u4ee3\u7406\u3002</p> <pre><code class="language-javascript">const target = {\n  m: function () {\n    console.log(this === proxy);\n  }\n};\nconst handler = {};\n\nconst proxy = new Proxy(target, handler);\n\ntarget.m() // false\nproxy.m()  // true</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c\u4e00\u65e6<code>proxy</code>\u4ee3\u7406<code>target.m</code>\uff0c\u540e\u8005\u5185\u90e8\u7684<code>this</code>\u5c31\u662f\u6307\u5411<code>proxy</code>\uff0c\u800c\u4e0d\u662f<code>target</code>\u3002</p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u4f8b\u5b50\uff0c\u7531\u4e8e<code>this</code>\u6307\u5411\u7684\u53d8\u5316\uff0c\u5bfc\u81f4 Proxy \u65e0\u6cd5\u4ee3\u7406\u76ee\u6807\u5bf9\u8c61\u3002</p> <pre><code class="language-javascript">const _name = new WeakMap();\n\nclass Person {\n  constructor(name) {\n    _name.set(this, name);\n  }\n  get name() {\n    return _name.get(this);\n  }\n}\n\nconst jane = new Person(&#39;Jane&#39;);\njane.name // &#39;Jane&#39;\n\nconst proxy = new Proxy(jane, {});\nproxy.name // undefined</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c\u76ee\u6807\u5bf9\u8c61<code>jane</code>\u7684<code>name</code>\u5c5e\u6027\uff0c\u5b9e\u9645\u4fdd\u5b58\u5728\u5916\u90e8<code>WeakMap</code>\u5bf9\u8c61<code>_name</code>\u4e0a\u9762\uff0c\u901a\u8fc7<code>this</code>\u952e\u533a\u5206\u3002\u7531\u4e8e\u901a\u8fc7<code>proxy.name</code>\u8bbf\u95ee\u65f6\uff0c<code>this</code>\u6307\u5411<code>proxy</code>\uff0c\u5bfc\u81f4\u65e0\u6cd5\u53d6\u5230\u503c\uff0c\u6240\u4ee5\u8fd4\u56de<code>undefined</code>\u3002</p> <p>\u6b64\u5916\uff0c\u6709\u4e9b\u539f\u751f\u5bf9\u8c61\u7684\u5185\u90e8\u5c5e\u6027\uff0c\u53ea\u6709\u901a\u8fc7\u6b63\u786e\u7684<code>this</code>\u624d\u80fd\u62ff\u5230\uff0c\u6240\u4ee5 Proxy \u4e5f\u65e0\u6cd5\u4ee3\u7406\u8fd9\u4e9b\u539f\u751f\u5bf9\u8c61\u7684\u5c5e\u6027\u3002</p> <pre><code class="language-javascript">const target = new Date();\nconst handler = {};\nconst proxy = new Proxy(target, handler);\n\nproxy.getDate();\n// TypeError: this is not a Date object.</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c<code>getDate</code>\u65b9\u6cd5\u53ea\u80fd\u5728<code>Date</code>\u5bf9\u8c61\u5b9e\u4f8b\u4e0a\u9762\u62ff\u5230\uff0c\u5982\u679c<code>this</code>\u4e0d\u662f<code>Date</code>\u5bf9\u8c61\u5b9e\u4f8b\u5c31\u4f1a\u62a5\u9519\u3002\u8fd9\u65f6\uff0c<code>this</code>\u7ed1\u5b9a\u539f\u59cb\u5bf9\u8c61\uff0c\u5c31\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <pre><code class="language-javascript">const target = new Date(&#39;2015-01-01&#39;);\nconst handler = {\n  get(target, prop) {\n    if (prop === &#39;getDate&#39;) {\n      return target.getDate.bind(target);\n    }\n    return Reflect.get(target, prop);\n  }\n};\nconst proxy = new Proxy(target, handler);\n\nproxy.getDate() // 1</code></pre> <h2 id="\u5b9e\u4f8b\uff1aweb-\u670d\u52a1\u7684\u5ba2\u6237\u7aef">\u5b9e\u4f8b\uff1aWeb \u670d\u52a1\u7684\u5ba2\u6237\u7aef</h2> <p>Proxy \u5bf9\u8c61\u53ef\u4ee5\u62e6\u622a\u76ee\u6807\u5bf9\u8c61\u7684\u4efb\u610f\u5c5e\u6027\uff0c\u8fd9\u4f7f\u5f97\u5b83\u5f88\u5408\u9002\u7528\u6765\u5199 Web \u670d\u52a1\u7684\u5ba2\u6237\u7aef\u3002</p> <pre><code class="language-javascript">const service = createWebService(&#39;http://example.com/data&#39;);\n\nservice.employees().then(json =&gt; {\n  const employees = JSON.parse(json);\n  // \xb7\xb7\xb7\n});</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u65b0\u5efa\u4e86\u4e00\u4e2a Web \u670d\u52a1\u7684\u63a5\u53e3\uff0c\u8fd9\u4e2a\u63a5\u53e3\u8fd4\u56de\u5404\u79cd\u6570\u636e\u3002Proxy \u53ef\u4ee5\u62e6\u622a\u8fd9\u4e2a\u5bf9\u8c61\u7684\u4efb\u610f\u5c5e\u6027\uff0c\u6240\u4ee5\u4e0d\u7528\u4e3a\u6bcf\u4e00\u79cd\u6570\u636e\u5199\u4e00\u4e2a\u9002\u914d\u65b9\u6cd5\uff0c\u53ea\u8981\u5199\u4e00\u4e2a Proxy \u62e6\u622a\u5c31\u53ef\u4ee5\u4e86\u3002</p> <pre><code class="language-javascript">function createWebService(baseUrl) {\n  return new Proxy({}, {\n    get(target, propKey, receiver) {\n      return () =&gt; httpGet(baseUrl+&#39;/&#39; + propKey);\n    }\n  });\n}</code></pre> <p>\u540c\u7406\uff0cProxy \u4e5f\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0\u6570\u636e\u5e93\u7684 ORM \u5c42\u3002</p> ';e.exports=r}}]);