(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["docs/loophole/xss"],{dd25:function(t,e){var p='<h1 id="xss-\u8de8\u7ad9\u811a\u672c\u653b\u51fb">XSS \u8de8\u7ad9\u811a\u672c\u653b\u51fb</h1> <p>XSS (Cross Site Scripting)\uff0c\u5168\u79f0\u53eb\u505a <code>\u8de8\u7ad9\u811a\u672c\u653b\u51fb</code></p> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4eec\u662f\u5e0c\u671b\u7f51\u7ad9\u8fd0\u884c\u7684\u4e1c\u897f\u662f\u6765\u81ea\u4e0e\u672c\u7ad9\u7684\u3002\u5982\u679c\u7f51\u7ad9\u8fd0\u884c\u4e86\u4e00\u4e2a\u522b\u7684\u7f51\u7ad9\u7684\u4e1c\u897f\uff0c\u90a3\u4e48\u5c31\u4ea7\u751f\u4e86\u4e00\u4e2a\u8de8\u7ad9\u811a\u672c\u653b\u51fb</p> <p>\u8de8\u7ad9\u811a\u672c\u653b\u51fb\u5e76\u4e0d\u662f\u4e00\u5b9a\u8981\u5f15\u7528\u4e00\u4e2a\u8fdc\u7a0b\u7684\u811a\u672c\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u5185\u8054\u7684\u811a\u672c\uff0c\u6bd4\u5982\u7ecf\u5e38\u4f7f\u7528 <code>alert</code> \u6765\u63a2\u6d4b\u662f\u5426\u6709 XSS \u6f0f\u6d1e</p> <p>\u4f8b\u5b50\u4e2d\u4f7f\u7528\u7684\u6a21\u677f\u5f15\u64ce\u4e3a pug (jade)</p> <h2 id="1-\u5371\u5bb3">1 \u5371\u5bb3</h2> <ul> <li><p>\u83b7\u53d6\u9875\u9762\u6570\u636e (\u9875\u9762\u5185\u7684\u4efb\u4f55\u5185\u5bb9\u548c js \u7684\u6570\u636e)</p> </li> <li><p>\u83b7\u53d6 Cookies</p> </li> <li><p>\u52ab\u6301\u524d\u7aef\u903b\u8f91 (\u6bd4\u5982\u66f4\u6539\u67d0\u4e2a\u6309\u94ae\u7684\u4e8b\u4ef6)</p> </li> <li><p>\u53d1\u9001\u8bf7\u6c42 (\u5c06\u654f\u611f\u4fe1\u606f\u53d1\u9001\u5230\u653b\u51fb\u8005\u7684\u670d\u52a1\u5668)</p> </li> <li><p>\u53d6\u51b3\u4e8e\u653b\u51fb\u8005\u7684\u60f3\u8c61\u529b</p> </li> <li><p>\u5077\u53d6\u7f51\u7ad9\u4efb\u610f\u6570\u636e</p> </li> <li><p>\u5077\u53d6\u7528\u6237\u8d44\u6599</p> </li> <li><p>\u5077\u53d6\u7528\u6237\u5bc6\u7801\u548c\u767b\u5f55\u6001</p> </li> <li><p>\u6b3a\u9a97\u7528\u6237</p> </li> </ul> <h2 id="2-\u653b\u51fb\u7c7b\u578b">2 \u653b\u51fb\u7c7b\u578b</h2> <h3 id="21-\u53cd\u5c04\u578b">2.1 \u53cd\u5c04\u578b</h3> <p>url \u53c2\u6570\u76f4\u63a5\u6ce8\u5165\u3002\u653b\u51fb\u4ee3\u7801\u76f4\u63a5\u662f\u7531 url \u5e26\u8fc7\u6765\u7684\uff0c\u800c\u4e14\u9875\u9762\u76f4\u63a5\u663e\u793a\u4e86\u8fd9\u6bb5\u4ee3\u7801</p> <p>\u6211\u4eec\u7ecf\u5e38\u7528 url query \u6765\u4f20\u9012\u6570\u636e</p> <p>\u6bd4\u5982 <code>http://www.xxx.com?name=233</code>\uff0c\u5982\u679c\u5c06 name \u7684\u503c\u901a\u8fc7 innerHTML \u7684\u65b9\u5f0f\u63d2\u5165\u5230\u9875\u9762\u4e2d\uff0c\u90a3\u4e48\u8fd9\u91cc\u5c31\u4f1a\u6709 XSS \u6f0f\u6d1e</p> <p>\u5982\uff1a<code>http://www.xxx.com?name=&lt;script&gt;alert(1)&lt;%2Fscript&gt;</code></p> <p>\u5982\u8fc7 name \u7684\u503c\u5305\u542b\u4e00\u4e2a\u811a\u672c\uff0c\u90a3\u4e48\u6253\u5f00\u9875\u9762\u7684\u65f6\u5019\u5c31\u4f1a\u8fd0\u884c\u3002\u5982\u679c\u5c06\u8fd9\u4e2a\u94fe\u63a5\u53d1\u7ed9\u522b\u4eba\uff0c\u522b\u4eba\u6253\u5f00\u8fd9\u4e2a\u94fe\u63a5\u5c31\u80fd\u76d7\u53d6\u4ed6\u7684\u4fe1\u606f</p> <h3 id="22-\u5b58\u50a8\u578b">2.2 \u5b58\u50a8\u578b</h3> <p>\u5b58\u50a8\u5230 DB \u540e\u8bfb\u53d6\u65f6\u6ce8\u5165</p> <p>\u6bd4\u5982\u53d1\u8868\u8bc4\u8bba\u6216\u8005\u6587\u7ae0\u7684\u65f6\u5019\uff0c\u4f1a\u5148\u5b58\u50a8\u5230\u6570\u636e\u5e93\u3002\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u8fd9\u6761\u4ee3\u7801\u4f1a\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u51fa\u6765\uff0c\u7136\u540e\u663e\u793a\u5230\u7528\u6237\u7684\u9875\u9762\u4e0a</p> <p>\u8f93\u5165\u8bc4\u8bba\u7684\u65f6\u5019\u53ef\u4ee5\u8f93\u5165\u811a\u672c\u6807\u7b7e\uff0c\u5728\u9875\u9762\u4e2d\u5c55\u793a\u8bc4\u8bba\u7684\u65f6\u5019\uff0c\u5982\u679c\u672a\u505a\u5904\u7406\uff0c\u8fd9\u4e48\u811a\u672c\u5c31\u4f1a\u5728\u9875\u9762\u4e2d\u8fd0\u884c</p> <p>\u90a3\u4e48\u4efb\u610f\u4e00\u4e2a\u770b\u5230\u8fd9\u6761\u8bc4\u8bba\u7684\u7528\u6237\u90fd\u53ef\u80fd\u4f1a\u53d7\u5230 XSS \u653b\u51fb</p> <p>\u5982\u679c\u8fd9\u4e2a\u7cfb\u7edf\u6709\u7ba1\u7406\u7aef\uff0c\u751a\u81f3\u53ef\u4ee5\u653b\u51fb\u5230\u7ba1\u7406\u7aef\uff0c\u83b7\u53d6\u7ba1\u7406\u5458\u7684\u4fe1\u606f</p> <blockquote> <p>\u53cd\u5c04\u578b\u7684\u5371\u5bb3\u7565\u5c0f\u4e00\u4e9b\uff0c\u56e0\u4e3a\u4ee3\u7801\u76f4\u63a5\u66b4\u9732\u5728 url \u4e2d\uff0c\u800c\u5b58\u50a8\u578b\u5f88\u96be\u5bdf\u89c9\u5230\uff0c\u53cd\u5c04\u578b\u4e5f\u53ef\u4ee5\u901a\u8fc7\u751f\u6210\u4e00\u4e2a\u77ed\u7f51\u5740\u7684\u65b9\u5f0f\u9690\u85cf\u6389\u653b\u51fb\u4ee3\u7801</p> </blockquote> <h2 id="3-xss-\u653b\u51fb\u6ce8\u5165\u70b9">3 XSS \u653b\u51fb\u6ce8\u5165\u70b9</h2> <h3 id="31-html-\u8282\u70b9\u5185\u5bb9">3.1 HTML \u8282\u70b9\u5185\u5bb9</h3> <p>\u8282\u70b9\u5185\u5bb9\u662f\u52a8\u6001\u751f\u6210\u7684\uff0c\u5c55\u793a\u7528\u6237\u8f93\u5165\u7684\u6570\u636e</p> <p>\u4f8b\u5982\uff1a</p> <pre><code class="language-html">&lt;!-- \u901a\u8fc7\u540e\u7aef\u6a21\u677f\u63d2\u5165\u6570\u636e --&gt;\n&lt;div&gt;\n  #{content}\n&lt;/div&gt;\n\n&lt;!-- \u5982\u679c\u6570\u636e\u4e3a\u4e00\u4e2a script \u6807\u7b7e\uff0c\u5c31\u4f1a\u8fd0\u884c --&gt;\n&lt;div&gt;\n  &lt;script&gt;&lt;/script&gt;\n&lt;/div&gt;</code></pre> <h3 id="32-html-\u5c5e\u6027">3.2 HTML \u5c5e\u6027</h3> <p>\u8282\u70b9\u5c5e\u6027\u662f\u7528\u6237\u8f93\u5165\u7684\u6570\u636e\uff0c\u53ef\u80fd\u4f1a\u8d8a\u51fa\u5c5e\u6027\u7684\u8303\u56f4</p> <p>\u4f8b\u5982\uff1a\u56fe\u7247\u7684 src \u5c5e\u6027\uff0csrc \u662f\u4e00\u4e2a\u52a8\u6001\u7684\u503c</p> <p>src \u7684\u5185\u5bb9\u4e3a <code>1&quot; onerror=&quot;alert(1)</code> \u5c31\u4f1a\u51fa\u73b0\u4e0b\u9762\u8fd9\u79cd\u60c5\u51b5</p> <pre><code class="language-html">&lt;img src=&quot;#{image}&quot; /&gt;\n\n&lt;img src=&quot;1&quot; onerror=&quot;alert(1)&quot; /&gt;</code></pre> <h3 id="33-javascript-\u4ee3\u7801">3.3 JavaScript \u4ee3\u7801</h3> <p>\u4ee3\u7801\u4e2d\u5b58\u5728\u7531\u540e\u53f0\u6ce8\u5165\u7684\u53d8\u91cf\uff0c\u91cc\u9762\u5305\u542b\u7528\u6237\u8f93\u5165\u7684\u4fe1\u606f\uff0c\u4f1a\u6539\u53d8\u4ee3\u7801\u8fd0\u884c\u7684\u903b\u8f91</p> <p>\u4f8b\u5982\uff1a</p> <pre><code class="language-html">&lt;script&gt;\n  var data = &#39;#{data}&#39;;\n  // var data = &quot;hello&quot;;alert(1);&quot;&quot;;\n&lt;/script&gt;</code></pre> <blockquote> <p>\u4e00\u822c\u524d\u540e\u7aef\u5206\u79bb\u7684\u9879\u76ee\u4e0d\u4f1a\u51fa\u73b0\u8fd9\u4e2a\u95ee\u9898\uff0c\u53d8\u91cf\u662f\u901a\u8fc7\u540e\u7aef\u6a21\u677f\u8d4b\u503c\u7684\uff0c\u8fd0\u884c\u65f6\u8d4b\u503c\u4e0d\u51fa\u73b0\u8fd9\u4e2a\u95ee\u9898 (\u5f85\u9a8c\u8bc1)</p> </blockquote> <h3 id="34-\u5bcc\u6587\u672c">3.4 \u5bcc\u6587\u672c</h3> <p>\u5bcc\u6587\u672c\u4e00\u5927\u6bb5 html \u6807\u7b7e\uff0c\u800c\u5bcc\u6587\u672c\u9700\u8981\u4fdd\u7559 html\uff0chtml \u5c31\u4f1a\u6709 XSS \u7684\u98ce\u9669</p> <pre><code class="language-html">&lt;script&gt;\n  alert(1);\n&lt;/script&gt;\n&lt;img src=&quot;1&quot; onerror=&quot;alert(1)&quot; /&gt;\n&lt;a href=&quot;javascript:alert(1)&quot;&gt;\u94fe\u63a5&lt;/a&gt;\n&lt;div onclick=&quot;alert(1)&quot;&gt;233&lt;/div&gt;</code></pre> <h2 id="4-xss-\u9632\u5fa1">4 XSS \u9632\u5fa1</h2> <h3 id="41-html-\u8282\u70b9\u5185\u5bb9">4.1 HTML \u8282\u70b9\u5185\u5bb9</h3> <p>\u8f6c\u4e49\u6807\u7b7e</p> <p>\u5c06 <code>&lt;</code> <code>&gt;</code> \u8f6c\u4e49\u6210 <code>&amp;lt;</code> <code>&amp;gt;</code>\uff0c\u8f6c\u4e49\u7684\u65f6\u673a\u53ef\u4ee5\u662f\u5728\u4fdd\u5b58\u5230\u6570\u636e\u5e93\u524d\uff0c\u6216\u8005\u662f\u5728\u9875\u9762\u5c55\u793a\u7684\u65f6\u5019\u8f6c\u4e49</p> <p>\u8f6c\u4e49\u540e script \u6807\u7b7e\u5c31\u4f1a\u4ee5\u5b57\u7b26\u4e32\u7684\u5f62\u5f0f\u5c55\u793a\u5728\u9875\u9762\u4e2d\uff0c\u800c\u4e0d\u4f1a\u8fd0\u884c</p> <p>\u7528\u6237\u8f93\u5165\u7684\u5185\u5bb9\u4f1a\u539f\u6837\u5c55\u793a\u5728\u9875\u9762\u4e0a</p> <h3 id="42-html-\u5c5e\u6027">4.2 HTML \u5c5e\u6027</h3> <p>\u8f6c\u4e49\u5f15\u53f7</p> <ul> <li>\u5c06\u53cc\u5f15\u53f7\u8f6c\u4e49\u6210 <code>&amp;quto;</code></li> <li>\u5355\u5f15\u53f7\u8f6c\u4e49\u6210 <code>&amp;#39;</code></li> <li>\u7a7a\u683c\u8f6c\u4e49\u6210 <code>&amp;#32;</code> (HTML \u5c5e\u6027\u53ef\u4ee5\u4e0d\u7528\u5f15\u53f7\u5305\u88f9\uff0c\u6240\u4ee5\u9700\u8981\u8f6c\u4e49\u7a7a\u683c)</li> </ul> <p>\u4e0a\u9762\u7684\u4f8b\u5b50\u5c31\u4f1a\u53d8\u6210\uff1a</p> <pre><code class="language-html">&lt;img src=&quot;#{image}&quot; /&gt;\n\n&lt;img src=&quot;1&amp;quto;&amp;#32;onerror=&amp;quto;alert(1)&quot; /&gt;</code></pre> <h3 id="43-javascript-\u4ee3\u7801">4.3 JavaScript \u4ee3\u7801</h3> <p>\u8f6c\u4e49\u5f15\u53f7\u548c\u659c\u6746</p> <ul> <li>\u5c06 <code>&#39;</code> \u8f6c\u4e49\u6210 <code>\\\\&#39;</code>\uff0c\u5373\u589e\u52a0\u4e00\u4e2a\u8f6c\u4e49\u7b26</li> <li>\u5c06 <code>&quot;</code> \u8f6c\u4e49\u6210 <code>\\\\&quot;</code>\uff0c\u5373\u589e\u52a0\u4e00\u4e2a\u8f6c\u4e49\u7b26</li> <li>\u5c06 <code>\\</code> \u8f6c\u4e49\u6210 <code>\\\\</code>\uff0c\u5373 <code>str.replace(/\\\\/g, &#39;\\\\\\\\&#39;)</code> \u56e0\u4e3a\u8f93\u5165\u7684\u659c\u6746\u53ef\u80fd\u4f1a\u88ab\u5f53\u4f5c\u8f6c\u4e49\u7b26</li> </ul> <p>\u8fd9\u4e00\u6b65\u901a\u5e38\u653e\u5728\u540e\u7aef\u903b\u8f91\u4e2d</p> <p>\u6216\u8005\u4f7f\u7528 JSON \u8f6c\u4e49\uff0c<code>JSON.stringify</code> \u4f1a\u5c06\u6240\u4ee5\u9700\u8981\u8f6c\u4e49\u7684\u5185\u5bb9\u8f6c\u4e49\uff0c\u5305\u62ec\u4e0a\u9762\u63d0\u5230\u7684\u5f15\u53f7\u548c\u659c\u6746</p> <h3 id="44-\u5bcc\u6587\u672c">4.4 \u5bcc\u6587\u672c</h3> <p>XSS \u9632\u5fa1\u6700\u96be\u5904\u7406\u7684\u5c31\u662f\u5bcc\u6587\u672c\uff0c\u5bcc\u6587\u672c\u662f\u4e00\u5927\u6bb5 html</p> <p>\u65e2\u7136\u662f\u5bcc\u6587\u672c\uff0c\u5c31\u9700\u8981\u4fdd\u7559\u8fd9\u4e9b\u683c\u5f0f\uff0c\u6ca1\u529e\u6cd5\u5c06\u6807\u7b7e\u5168\u90e8\u8f6c\u4e49</p> <p>\u4e00\u822c\u7684\u5904\u7406\u65b9\u5f0f\u662f\u8fc7\u6ee4\uff0c\u8fc7\u6ee4\u6709\u4e24\u79cd\uff0c\u9ed1\u540d\u5355\u548c\u767d\u540d\u5355</p> <ul> <li>\u9ed1\u540d\u5355\uff0c\u8fc7\u6ee4 script \u6807\u7b7e\u548c onerror \u7b49\u5c5e\u6027\u3002\u5b9e\u73b0\u8f83\u7b80\u5355\uff0c\u4f46\u662f html \u592a\u7e41\u6742\uff0c\u53ef\u80fd\u8fc7\u6ee4\u4e0d\u5168</li> <li>\u6309\u767d\u540d\u5355\u4fdd\u7559\u90e8\u5206\u6807\u7b7e\u548c\u5c5e\u6027\u3002\u767d\u540d\u5355\u662f\u8f83\u4e3a\u5b89\u5168\u7684\u65b9\u5f0f\uff0c\u4e0d\u8fc7\u5b9e\u73b0\u590d\u6742</li> </ul> <p>\u76ee\u524d\u4e5f\u6709\u73b0\u6210\u5e93\u7528\u6765\u5904\u7406\u5bcc\u6587\u672c <a href="https://github.com/leizongmin/js-xss">https://github.com/leizongmin/js-xss</a></p> <h3 id="45-innerhtml">4.5 innerHTML</h3> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/innerHTML">innerHTML \u6587\u6863</a></p> <p>\u7528 innerHTML \u63d2\u5165\u6587\u672c\u5230\u7f51\u9875\u4e2d\u5e76\u4e0d\u7f55\u89c1\u3002\u4f46\u8fd9\u6709\u53ef\u80fd\u6210\u4e3a\u7f51\u7ad9\u653b\u51fb\u7684\u5a92\u4ecb\uff0c\u4ece\u800c\u4ea7\u751f\u6f5c\u5728\u7684\u5b89\u5168\u98ce\u9669\u95ee\u9898\u3002</p> <pre><code class="language-javascript">const name = &#39;John&#39;;\n// assuming &#39;el&#39; is an HTML DOM element\nel.innerHTML = name; // harmless in this case\n\n// ...\n\nname = &quot;&lt;script&gt;alert(&#39;I am John in an annoying alert!&#39;)&lt;/script&gt;&quot;;\nel.innerHTML = name; // harmless in this case</code></pre> <p>\u5c3d\u7ba1\u8fd9\u770b\u4e0a\u53bb\u50cf <code>cross-site scripting</code> \u653b\u51fb\uff0c\u7ed3\u679c\u5e76\u4e0d\u4f1a\u5bfc\u81f4\u4ec0\u4e48\u3002HTML 5 \u4e2d\u6307\u5b9a\u4e0d\u6267\u884c\u7531 innerHTML \u63d2\u5165\u7684 <code>&lt;script&gt;</code> \u6807\u7b7e\u3002</p> <p>\u7136\u800c\uff0c\u6709\u5f88\u591a\u4e0d\u4f9d\u8d56 <code>&lt;script&gt;</code> \u6807\u7b7e\u53bb\u6267\u884c JavaScript \u7684\u65b9\u5f0f\u3002\u6240\u4ee5\u5f53\u4f60\u4f7f\u7528 innerHTML \u53bb\u8bbe\u7f6e\u4f60\u65e0\u6cd5\u63a7\u5236\u7684\u5b57\u7b26\u4e32\u65f6\uff0c\u8fd9\u4ecd\u7136\u662f\u4e00\u4e2a\u5b89\u5168\u95ee\u9898\u3002\u4f8b\u5982\uff1a</p> <pre><code class="language-javascript">const name = &quot;&lt;img src=&#39;x&#39; onerror=&#39;alert(1)&#39;&gt;&quot;;\nel.innerHTML = name; // shows the alert</code></pre> <p>\u57fa\u4e8e\u8fd9\u4e2a\u539f\u56e0\uff0c\u5f53\u63d2\u5165\u7eaf\u6587\u672c\u65f6\uff0c\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528 innerHTML \u3002\u53d6\u800c\u4ee3\u4e4b\u7684\u662f\u4f7f\u7528 Node.textContent \uff0c\u5b83\u4e0d\u4f1a\u628a\u7ed9\u5b9a\u7684\u5185\u5bb9\u89e3\u6790\u4e3a HTML\uff0c\u5b83\u4ec5\u4ec5\u662f\u5c06\u539f\u59cb\u6587\u672c\u63d2\u5165\u7ed9\u5b9a\u7684\u4f4d\u7f6e\u3002</p> <h2 id="5-csp">5 CSP</h2> <p>CSP (Content Security Policy)\uff0c\u5b83\u662f\u4e00\u4e2a http \u7684\u54cd\u5e94\u5934</p> <p>\u5168\u79f0\u53eb\u5185\u5bb9\u5b89\u5168\u7b56\u7565\uff0c\u7528\u4e8e\u6307\u5b9a\u54ea\u4e9b\u5185\u5bb9\u53ef\u6267\u884c\uff0c\u5373\u4f7f\u9875\u9762\u91cc\u9762\u6709\u4e00\u4e9b\u6ce8\u5165\u7684\u5185\u5bb9\uff0c\u5b83\u4e5f\u4e0d\u4f1a\u6267\u884c</p> <p>CSP \u662f\u4e00\u4e2a\u53ef\u884c\u6027\u6bd4\u8f83\u9ad8\u7684 XSS \u9632\u5fa1\u65b9\u6848</p> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP">MDN \u6587\u6863 https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP</a></p> ';t.exports=p}}]);