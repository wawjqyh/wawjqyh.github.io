(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["docs/designPattern/observer"],{"52zx":function(n,t,e){var o=e("Rxnk"),i=e("Ylko"),s=o(i),r='<h1 id="\u89c2\u5bdf\u8005\u6a21\u5f0f">\u89c2\u5bdf\u8005\u6a21\u5f0f</h1> <h2 id="1-\u6982\u5ff5">1 \u6982\u5ff5</h2> <p>\u901a\u5e38\u53c8\u88ab\u79f0\u4e3a <strong>\u53d1\u5e03-\u8ba2\u9605\u8005\u6a21\u5f0f</strong> \u6216 <strong>\u6d88\u606f\u673a\u5236</strong>\uff0c\u5b83\u5b9a\u4e49\u4e86\u5bf9\u8c61\u95f4\u7684\u4e00\u79cd\u4e00\u5bf9\u591a\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u53ea\u8981\u5f53\u4e00\u4e2a\u5bf9\u8c61\u7684\u72b6\u6001\u53d1\u751f\u6539\u53d8\u65f6\uff0c\u6240\u6709\u4f9d\u8d56\u4e8e\u5b83\u7684\u5bf9\u8c61\u90fd\u5f97\u5230\u901a\u77e5\u5e76\u88ab\u81ea\u52a8\u66f4\u65b0\uff0c\u89e3\u51b3\u4e86\u4e3b\u4f53\u5bf9\u8c61\u4e0e\u89c2\u5bdf\u8005\u4e4b\u95f4\u529f\u80fd\u7684\u8026\u5408\uff0c\u5373\u4e00\u4e2a\u5bf9\u8c61\u72b6\u6001\u6539\u53d8\u7ed9\u5176\u4ed6\u5bf9\u8c61\u901a\u77e5\u7684\u95ee\u9898</p> <p><img src="'+s+'" alt=""></p> <h2 id="2-\u5b9e\u4f8b">2 \u5b9e\u4f8b</h2> <h3 id="21-\u89c2\u5bdf\u8005\u6a21\u5f0f">2.1 \u89c2\u5bdf\u8005\u6a21\u5f0f</h3> <pre><code class="language-js">// \u4e3b\u9898\uff0c\u4fdd\u5b58\u72b6\u6001\uff0c\u72b6\u6001\u53d8\u5316\u4e4b\u540e\u89e6\u53d1\u6240\u6709\u89c2\u5bdf\u8005\u5bf9\u8c61\nclass Subject {\n  constructor() {\n    this.state = 0;\n    this.observers = [];\n  }\n\n  getState() {\n    return this.state;\n  }\n\n  // \u72b6\u6001\u6539\u53d8\uff0c\u901a\u77e5\u6240\u6709\u89c2\u5bdf\u8005\n  setState(state) {\n    this.state = state;\n    this.notifyAllObservers();\n  }\n\n  notifyAllObservers() {\n    this.observers.forEach(observer =&gt; {\n      observer.update();\n    });\n  }\n\n  // \u6dfb\u52a0\u89c2\u5bdf\u8005\n  attach(observer) {\n    this.observers.push(observer);\n  }\n}\n\n// \u89c2\u5bdf\u8005\nclass Observer {\n  constructor(name, subject) {\n    this.name = name;\n    this.subject = subject;\n    this.subject.attach(this);\n  }\n\n  // \u63a5\u6536\u901a\u77e5\n  update() {\n    console.log(`${this.name} update, state: ${this.subject.getState()}`);\n  }\n}\n\nlet s = new Subject();\nlet o1 = new Observer(&#39;o1&#39;, s);\nlet o2 = new Observer(&#39;o2&#39;, s);\n\ns.setState(1);\ns.setState(2);</code></pre> <h3 id="22-eventemit">2.2 eventEmit</h3> <pre><code class="language-js">let event = {\n  list: {},\n\n  on(key, fn) {\n    if (!this.list[key]) {\n      this.list[key] = [];\n    }\n    this.list[key].push(fn);\n  },\n\n  emit() {\n    let key = [].shift.call(arguments);\n    let fns = this.list[key];\n\n    if (!fns || fns.length === 0) {\n      return false;\n    }\n\n    fns.forEach(fn =&gt; {\n      fn.apply(this, arguments);\n    });\n  },\n\n  remove(key, fn) {\n    let fns = this.list[key];\n    // \u5982\u679c\u7f13\u5b58\u5217\u8868\u4e2d\u6ca1\u6709\u51fd\u6570\uff0c\u8fd4\u56defalse\n    if (!fns) return false;\n    // \u5982\u679c\u6ca1\u6709\u4f20\u5bf9\u5e94\u51fd\u6570\u7684\u8bdd\n    // \u5c31\u4f1a\u5c06key\u503c\u5bf9\u5e94\u7f13\u5b58\u5217\u8868\u4e2d\u7684\u51fd\u6570\u90fd\u6e05\u7a7a\u6389\n    if (!fn) {\n      fns = [];\n    } else {\n      // \u904d\u5386\u7f13\u5b58\u5217\u8868\uff0c\u770b\u770b\u4f20\u5165\u7684fn\u4e0e\u54ea\u4e2a\u51fd\u6570\u76f8\u540c\n      // \u5982\u679c\u76f8\u540c\u5c31\u76f4\u63a5\u4ece\u7f13\u5b58\u5217\u8868\u4e2d\u5220\u6389\u5373\u53ef\n      fns.forEach((cb, i) =&gt; {\n        if (cb === fn) {\n          fns.splice(i, 1);\n        }\n      });\n    }\n  }\n};\n\nfunction cat() {\n  console.log(&#39;\u4e00\u8d77\u55b5\u55b5\u55b5&#39;);\n}\nfunction dog() {\n  console.log(&#39;\u4e00\u8d77\u65fa\u65fa\u65fa&#39;);\n}\n\nevent.on(&#39;pet&#39;, data =&gt; {\n  console.log(&#39;\u63a5\u6536\u6570\u636e&#39;);\n  console.log(data);\n});\n\nevent.on(&#39;pet&#39;, cat);\nevent.on(&#39;pet&#39;, dog);\n\n// \u53d6\u6d88dog\u65b9\u6cd5\u7684\u8ba2\u9605\nevent.remove(&#39;pet&#39;, dog);\n// \u53d1\u5e03\nevent.emit(&#39;pet&#39;, [&#39;\u4e8c\u54c8&#39;, &#39;\u6ce2\u65af\u732b&#39;]);</code></pre> <h2 id="3-\u4f7f\u7528\u573a\u666f">3 \u4f7f\u7528\u573a\u666f</h2> <h3 id="31-\u7f51\u9875\u4e8b\u4ef6\u7ed1\u5b9a">3.1 \u7f51\u9875\u4e8b\u4ef6\u7ed1\u5b9a</h3> <p>\u6240\u6709\u6d89\u53ca\u4e8b\u4ef6\u76d1\u542c\u7684\u573a\u666f\u90fd\u662f\u89c2\u5bdf\u8005\u6a21\u5f0f</p> <pre><code class="language-html">&lt;div id=&quot;btn&quot;&gt;btn&lt;/div&gt;\n\n&lt;script&gt;\n  let btn = document.querySelector(&#39;#btn&#39;);\n\n  btn.addEventListener(&#39;click&#39;, () =&gt; {\n    console.log(&#39;\u70b9\u51fb\u4e86&#39;);\n  });\n&lt;/script&gt;</code></pre> <h3 id="32-promise">3.2 Promise</h3> <p>Promise \u4e5f\u662f\u89c2\u5bdf\u8005\u6a21\u5f0f</p> <pre><code class="language-js">// \u6a21\u62df\u52a0\u8f7d\u4e00\u5f20\u56fe\u7247\nfunction loadImg() {\n  return new Promise((resolve, reject) =&gt; {\n    setTimeout(() =&gt; {\n      resolve({ width: 600, height: 400 });\n    }, 1000);\n  });\n}\n\nlet res = loadImg();\nres\n  .then(img =&gt; {\n    console.log(img.width);\n    return img;\n  })\n  .then(img =&gt; {\n    console.log(img.height);\n  });</code></pre> <h3 id="34-node-\u81ea\u5b9a\u4e49\u4e8b\u4ef6">3.4 node \u81ea\u5b9a\u4e49\u4e8b\u4ef6</h3> <pre><code class="language-js">const EventEmitter = require(&#39;events&#39;).EventEmitter;\n\nconst emitter = new EventEmitter();\n\nemitter.on(&#39;hello&#39;, () =&gt; {\n  console.log(&#39;hello world&#39;);\n});\n\nemitter.emit(&#39;hello&#39;);</code></pre> <p>\u4e00\u822c\u6bd4\u8f83\u5c11\u76f4\u63a5\u7528 EventEmitter \u6a21\u5757\uff0c\u5f88\u591a node \u6a21\u5757\u7ee7\u627f\u4e86 EventEmitter \u7c7b\uff0c\u6bd4\u5982 <code>fs.createReadStream</code></p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u7ee7\u627f EventEmitter \u7c7b\u5b9e\u73b0\u7c7b\u4f3c\u7684\u529f\u80fd</p> <pre><code class="language-js">const fs = require(&#39;fs&#39;);\n\nconst file = fs.createReadStream(&#39;./README.md&#39;);\n\nfile.on(&#39;data&#39;, chunk =&gt; {\n  console.log(chunk.toString().length);\n});\nfile.on(&#39;end&#39;, () =&gt; {\n  console.log(&#39;end&#39;);\n});</code></pre> <h3 id="35-vue-react-\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u89e6\u53d1">3.5 vue react \u7ec4\u4ef6\u751f\u547d\u5468\u671f\u89e6\u53d1</h3> <h3 id="36-vue-\u53cc\u5411\u7ed1\u5b9a">3.6 vue \u53cc\u5411\u7ed1\u5b9a</h3> <pre><code class="language-html">&lt;div id=&quot;app&quot;&gt;\n  &lt;form&gt;\n    &lt;input type=&quot;text&quot; v-model=&quot;number&quot; /&gt;\n    &lt;button type=&quot;button&quot; v-click=&quot;increment&quot;&gt;\u589e\u52a0&lt;/button&gt;\n  &lt;/form&gt;\n  &lt;h3 v-bind=&quot;number&quot;&gt;&lt;/h3&gt;\n  &lt;form&gt;\n    &lt;input type=&quot;text&quot; v-model=&quot;count&quot; /&gt;\n    &lt;button type=&quot;button&quot; v-click=&quot;incre&quot;&gt;\u589e\u52a0&lt;/button&gt;\n  &lt;/form&gt;\n  &lt;h3 v-bind=&quot;count&quot;&gt;&lt;/h3&gt;\n&lt;/div&gt;</code></pre> <pre><code class="language-js">class MyVue {\n  constructor(options) {\n    this._init(options);\n  }\n\n  _init(options) {\n    this.$options = options;\n    this.$el = document.querySelector(options.el);\n    this.$data = options.data;\n    this.$methods = options.methods;\n\n    this._binding = {};\n    this._obverse(this.$data);\n    this._complie(this.$el);\n  }\n\n  _obverse(obj) {\n    var _this = this;\n    Object.keys(obj).forEach(function(key) {\n      if (obj.hasOwnProperty(key)) {\n        _this._binding[key] = {\n          _directives: []\n        };\n        console.log(_this._binding[key]);\n        var value = obj[key];\n        if (typeof value === &#39;object&#39;) {\n          _this._obverse(value);\n        }\n        var binding = _this._binding[key];\n        Object.defineProperty(_this.$data, key, {\n          enumerable: true,\n          configurable: true,\n          get: function() {\n            console.log(`${key}\u83b7\u53d6${value}`);\n            return value;\n          },\n          set: function(newVal) {\n            console.log(`${key}\u66f4\u65b0${newVal}`);\n            if (value !== newVal) {\n              value = newVal;\n              binding._directives.forEach(function(item) {\n                item.update();\n              });\n            }\n          }\n        });\n      }\n    });\n  }\n\n  _complie(root) {\n    var _this = this;\n    var nodes = root.children;\n    for (var i = 0; i &lt; nodes.length; i++) {\n      var node = nodes[i];\n      if (node.children.length) {\n        this._complie(node);\n      }\n\n      if (node.hasAttribute(&#39;v-click&#39;)) {\n        node.onclick = (function() {\n          var attrVal = nodes[i].getAttribute(&#39;v-click&#39;);\n          return _this.$methods[attrVal].bind(_this.$data);\n        })();\n      }\n\n      if (node.hasAttribute(&#39;v-model&#39;) &amp;&amp; (node.tagName === &#39;INPUT&#39; || node.tagName === &#39;TEXTAREA&#39;)) {\n        node.addEventListener(\n          &#39;input&#39;,\n          (function(key) {\n            var attrVal = node.getAttribute(&#39;v-model&#39;);\n            _this._binding[attrVal]._directives.push(new Watcher(&#39;input&#39;, node, _this, attrVal, &#39;value&#39;));\n\n            return function() {\n              _this.$data[attrVal] = nodes[key].value;\n            };\n          })(i)\n        );\n      }\n\n      if (node.hasAttribute(&#39;v-bind&#39;)) {\n        var attrVal = node.getAttribute(&#39;v-bind&#39;);\n        _this._binding[attrVal]._directives.push(new Watcher(&#39;text&#39;, node, _this, attrVal, &#39;innerHTML&#39;));\n      }\n    }\n  }\n}\n\nclass Watcher {\n  constructor(name, el, vm, exp, attr) {\n    this.name = name; //\u6307\u4ee4\u540d\u79f0\uff0c\u4f8b\u5982\u6587\u672c\u8282\u70b9\uff0c\u8be5\u503c\u8bbe\u4e3a&quot;text&quot;\n    this.el = el; //\u6307\u4ee4\u5bf9\u5e94\u7684DOM\u5143\u7d20\n    this.vm = vm; //\u6307\u4ee4\u6240\u5c5emyVue\u5b9e\u4f8b\n    this.exp = exp; //\u6307\u4ee4\u5bf9\u5e94\u7684\u503c\uff0c\u672c\u4f8b\u5982&quot;number&quot;\n    this.attr = attr; //\u7ed1\u5b9a\u7684\u5c5e\u6027\u503c\uff0c\u672c\u4f8b\u4e3a&quot;innerHTML&quot;\n\n    this.update();\n  }\n\n  // \u66f4\u65b0 html \u4e2d\u7684\u503c\n  update() {\n    this.el[this.attr] = this.vm.$data[this.exp];\n  }\n}\n\nwindow.onload = function() {\n  var app = new MyVue({\n    el: &#39;#app&#39;,\n\n    data: {\n      number: 0,\n      count: 0\n    },\n\n    methods: {\n      increment: function() {\n        this.number++;\n      },\n\n      incre: function() {\n        this.count++;\n      }\n    }\n  });\n};</code></pre> ';n.exports=r}}]);