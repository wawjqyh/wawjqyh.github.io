(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["docs/designPattern/decorator"],{VXFn:function(n,e){var t='<h1 id="\u88c5\u9970\u5668\u6a21\u5f0f">\u88c5\u9970\u5668\u6a21\u5f0f</h1> <h2 id="1-\u6982\u5ff5">1 \u6982\u5ff5</h2> <p>\u88c5\u9970\u5668\u6a21\u5f0f\u662f\u5728\u539f\u6709\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e00\u4e9b\u529f\u80fd\uff0c\u9002\u914d\u5668\u6a21\u5f0f\u4e3a\u4e3a\u65e7\u7684\u63a5\u53e3\u505a\u517c\u5bb9</p> <p><strong>\u88c5\u9970\u5668\u6a21\u5f0f\u7684\u7279\u6027\uff1a</strong></p> <ul> <li>\u4e3a\u5bf9\u8c61\u6dfb\u52a0\u65b0\u7684\u529f\u80fd</li> <li>\u4e0d\u6539\u53d8\u539f\u6709\u7684\u7ed3\u6784\u548c\u529f\u80fd</li> </ul> <h2 id="2-\u5b9e\u4f8b">2 \u5b9e\u4f8b</h2> <pre><code class="language-javascript">class Circle {\n  draw() {\n    console.log(&#39;\u753b\u4e00\u4e2a\u5706\u5f62&#39;);\n  }\n}\n\n// \u88c5\u9970\u5668\nclass Decorator {\n  constructor(circle) {\n    this.circle = circle;\n  }\n\n  draw() {\n    this.circle.draw();\n    // \u6dfb\u52a0\u65b0\u529f\u80fd\n    this.setRedBorder();\n  }\n\n  setRedBorder() {\n    console.log(&#39;\u8bbe\u7f6e\u7ea2\u8272\u8fb9\u6846&#39;);\n  }\n}\n\nlet circle = new Circle();\ncircle.draw();\n\nlet dec = new Decorator(circle);\ndec.draw();</code></pre> <h2 id="3-\u4f7f\u7528\u573a\u666f">3 \u4f7f\u7528\u573a\u666f</h2> <h3 id="31-\u7c7b\u88c5\u9970\u5668">3.1 \u7c7b\u88c5\u9970\u5668</h3> <pre><code class="language-javascript">// \u88c5\u9970\u7c7b\n@testDec\nclass Demo {\n  // ...\n}\n\nfunction testDec(target) {\n  target.isDec = true;\n}\n\nalert(Demo.isDec);</code></pre> <pre><code class="language-javascript">@decorator\nclass A {}\n\n// \u7b49\u540c\u4e8e\nclass A {}\nA = decorator(A) || A;</code></pre> <p>testDec \u5c31\u662f\u4e00\u4e2a\u88c5\u9970\u5668\u3002\u5b83\u4fee\u6539\u4e86 Demo \u8fd9\u4e2a\u7c7b\u7684\u884c\u4e3a\uff0c\u4e3a\u5b83\u52a0\u4e0a\u4e86\u9759\u6001\u5c5e\u6027 isDec\u3002testDec \u51fd\u6570\u7684\u53c2\u6570 target \u662f Demo \u7c7b\u672c\u8eab</p> <h3 id="32-\u7c7b\u88c5\u9970\u5668-\u4f20\u53c2\u6570">3.2 \u7c7b\u88c5\u9970\u5668-\u4f20\u53c2\u6570</h3> <pre><code class="language-javascript">// mixin\u793a\u4f8b\n\nfunction mixins(...list) {\n  // \u4f20\u53c2\u6570\u9700\u8981\u8fd4\u56de\u4e00\u4e2a\u51fd\u6570\n  return function(target) {\n    Object.assign(target.prototype, ...list);\n  };\n}\n\nconst Foo = {\n  foo() {\n    alert(&#39;foo&#39;);\n  }\n};\n\n@mixins(Foo)\nclass MyClass {}\n\nlet obj = new MyClass();\nobj.foo(); // &#39;foo&#39;</code></pre> <h3 id="33-\u65b9\u6cd5\u88c5\u9970\u5668">3.3 \u65b9\u6cd5\u88c5\u9970\u5668</h3> <p>\u65b9\u6cd5\u88c5\u9970\u5668\u6709\u56fa\u5b9a\u7684\u683c\u5f0f</p> <ul> <li>\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u7c7b\u7684\u539f\u578b\u5bf9\u8c61</li> <li>\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u6240\u8981\u88c5\u9970\u7684\u5c5e\u6027\u540d</li> <li>\u7b2c\u4e09\u4e2a\u53c2\u6570\u662f\u8be5\u5c5e\u6027\u7684\u63cf\u8ff0\u5bf9\u8c61\uff0cObject.defineProperty \u4e2d\u4f1a\u7528\u5230\u3002\u5373\uff1a</li> </ul> <pre><code class="language-javascript">{\n  value: specifiedFunction,\n  enumerable: false,\n  configurable: true,\n  writable: true\n}</code></pre> <blockquote> <p>\u65b9\u6cd5\u88c5\u9970\u5668\u9700\u8981\u8fd4\u56de descriptor</p> </blockquote> <pre><code class="language-javascript">function readonly(target, name, descriptor) {\n  descriptor.writable = false;\n  return descriptor;\n}\n\nclass Person {\n  constructor() {\n    this.first = &#39;hello&#39;;\n    this.last = &#39;world&#39;;\n  }\n\n  @readonly\n  name() {\n    return `${this.first} ${this.last}`;\n  }\n}\n\nlet p = new Person();\np.name = function() {}; // \u8fd9\u91cc\u4f1a\u62a5\u9519\uff0c\u56e0\u4e3a\u662f\u53ea\u8bfb\u7684</code></pre> <h3 id="34-\u65b9\u6cd5\u88c5\u9970\u5668-\u6dfb\u52a0-log">3.4 \u65b9\u6cd5\u88c5\u9970\u5668-\u6dfb\u52a0 log</h3> <p>\u662f\u5426\u9047\u5230\u8fc7\u8fd9\u6837\u7684\u60c5\u666f\uff0c\u6bd4\u5982\u4f7f\u7528 vue \u6846\u67b6\u7684\u65f6\u5019\uff0c\u4f7f\u7528\u4e86\u67d0\u4e2a\u65b9\u6cd5\u4f1a\u5728 console \u6253\u5370\u4e00\u4e9b\u65e5\u5fd7\uff0c\u8868\u793a\u8fd9\u4e2a\u65b9\u6cd5\u5373\u5c06\u88ab\u5f03\u7528\u8bf7\u4f7f\u7528\u65b0\u7684\u65b9\u6cd5\u66ff\u4ee3\u3002\u4f7f\u7528\u4e0b\u9762\u7684\u88c5\u9970\u5668\u5c31\u80fd\u5f88\u5bb9\u6613\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\u3002</p> <pre><code class="language-javascript">class Math {\n  @log\n  add(a, b) {\n    return a + b;\n  }\n}\n\nfunction log(target, name, descriptor) {\n  var oldValue = descriptor.value;\n\n  descriptor.value = function() {\n    console.log(&#39;\u6267\u884c\u4e86\u52a0\u6cd5&#39;);\n    return oldValue.apply(this, arguments);\n  };\n\n  return descriptor;\n}\n\nconst math = new Math();\nmath.add(2, 4);</code></pre> <h3 id="35-connect-\u662f\u5982\u4f55\u5b9e\u73b0\u7684">3.5 connect \u662f\u5982\u4f55\u5b9e\u73b0\u7684</h3> <p><code>connect</code> \u662f\u7528\u6765\u8fde\u63a5 <code>Redux</code> \u548c <code>React</code> \u7684\uff0c\u5b83\u5305\u5728\u6211\u4eec\u7684\u5bb9\u5668\u7ec4\u4ef6\u7684\u5916\u4e00\u5c42\uff0c\u5b83\u63a5\u6536\u4e0a\u9762 <code>Provider</code> \u63d0\u4f9b\u7684 <code>store</code> \u91cc\u9762\u7684 <code>state</code> \u548c <code>dispatch</code>\uff0c\u4f20\u7ed9\u4e00\u4e2a\u6784\u9020\u51fd\u6570\uff0c\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61\uff0c\u4ee5\u5c5e\u6027\u5f62\u5f0f\u4f20\u7ed9\u6211\u4eec\u7684\u5bb9\u5668\u7ec4\u4ef6\u3002<code>connect</code> \u662f\u4e00\u4e2a\u9ad8\u9636\u51fd\u6570\uff0c\u9996\u5148\u4f20\u5165 <code>mapStateToProps</code>\u3001<code>mapDispatchToProps</code>\uff0c\u7136\u540e\u8fd4\u56de\u4e00\u4e2a\u751f\u4ea7 Component \u7684\u51fd\u6570\u3002</p> <p>\u4e3b\u8981\u7684\u903b\u8f91\u5982\u4e0b\uff1a</p> <pre><code class="language-js">export default function connect(mapStateToProps, mapDispatchToProps, mergeProps, options = {}) {\n  return function wrapWithConnect(WrappedComponent) {\n    class Connect extends Component {\n      constructor(props, context) {\n        // \u4eceComponent\u5904\u83b7\u5f97store\n        this.store = props.store || context.store;\n        this.stateProps = computeStateProps(this.store, props);\n        this.dispatchProps = computeDispatchProps(this.store, props);\n        this.state = { storeState: null };\n        // \u5bf9stateProps\u3001dispatchProps\u3001parentProps\u8fdb\u884c\u5408\u5e76\n        this.updateState();\n      }\n\n      shouldComponentUpdate(nextProps, nextState) {\n        // \u8fdb\u884c\u5224\u65ad\uff0c\u5f53\u6570\u636e\u53d1\u751f\u6539\u53d8\u65f6\uff0cComponent\u91cd\u65b0\u6e32\u67d3\n        if (propsChanged || mapStateProducedChange || dispatchPropsChanged) {\n          this.updateState(nextProps);\n          return true;\n        }\n      }\n\n      componentDidMount() {\n        // \u6539\u53d8Component\u7684state\n        this.store.subscribe(() =&gt; {\n          this.setState({\n            storeState: this.store.getState()\n          });\n        });\n      }\n\n      render() {\n        // \u751f\u6210\u5305\u88f9\u7ec4\u4ef6Connect\n        return &lt;WrappedComponent {...this.nextState} /&gt;;\n      }\n    }\n\n    Connect.contextTypes = {\n      store: storeShape\n    };\n\n    return Connect;\n  };\n}</code></pre> ';n.exports=t}}]);